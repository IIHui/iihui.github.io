<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>Ruby基础 - Keep It Simple</title>
    <meta name="keywords" content="博客,思考,读书,笔记,技术,分享">
    
    <meta property="og:title" content="Ruby基础">
    <meta property="og:site_name" content="Keep It Simple">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="Ruby基础 - Keep It Simple" />
    <meta name="description" content="Swift | Go | C&#43;&#43; "> 
    <link rel="shortcut icon" href="https://iihui.github.io/img/favicon.ico" />
    <link rel="apple-touch-icon" href="https://iihui.github.io/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="https://iihui.github.io/img/apple-touch-icon.png" />
    <link href="https://iihui.github.io/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="https://iihui.github.io/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="https://iihui.github.io/css/main.css" rel="stylesheet" type="text/css" />
    <link href="https://iihui.github.io/css/syntax.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>

    <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/monokai-sublime.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/objectivec.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/clojure.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/kotlin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/yaml.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="https://iihui.github.io/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Keep It Simple</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">靡不有初，鲜克有终</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="https://iihui.github.io/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://iihui.github.io/tags/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-tag"></i> <br />标签
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://iihui.github.io/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://iihui.github.io/categories/%E7%BE%8E%E9%A3%9F/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-fire"></i> <br />美食
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://iihui.github.io/categories/%E5%90%8E%E6%9C%9F/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-edit"></i> <br />后期
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://iihui.github.io/categories/%E6%97%85%E8%A1%8C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-leaf"></i> <br />旅行
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://iihui.github.io/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>
<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
		<!-- src = "http://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> <\!--  -\-> -->
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>

<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
</head>
<body>

</body>
</html>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="https://iihui.github.io/post/ruby/" itemprop="url">
        Ruby基础
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">创建: </span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2022-08-14">
    2022-08-14
</time>
</span>
&nbsp; | &nbsp;
<span class="post-updated-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-check-o"></i>
</span>
<span class="post-meta-item-text">更新: </span>
<time itemprop="dateUpdated" content="2022-08-14">
    2022-08-14
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类: </span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="https://iihui.github.io/categories/ruby" itemprop="url" rel="index">
        <span itemprop="name">ruby</span>
      </a>
      &nbsp; 
    </span>
  
</span>


      <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-file-word-o"></i>
</span>
<span class="post-meta-item-text">字数: </span>
<span class="leancloud-visitors-count">26792</span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-coffee"></i>
</span>
<span class="post-meta-item-text">阅读: </span>
<span class="leancloud-visitors-count">54 分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><code>Ruby</code>只是数百种编程语言中的一种，但它很特别，因为对许多程序员来说，它很像一种自然语言（会让人感觉出奇地像英语），同时又具有计算机所要求的清晰性。例如，如果运行下面的代码，将会打印<code>Hello, world!</code>字符串<code>10</code>次。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#ae81ff">10</span><span style="color:#f92672">.</span>times <span style="color:#66d9ef">do</span> print <span style="color:#e6db74">&#34;Hello, world!&#34;</span> <span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>在<code>irb</code>中，上面代码运行后除了会打印十次<code>Hello, world!</code>，还会紧跟着<code>=&gt; 10</code>，这表明<code>10.times do print &quot;Hello, world!&quot; end</code>作为表达式的结果为<code>10</code>。这是因为<code>Ruby</code>中<font color="#de7802">所有代码都是由有返回值的表达式组成的</font>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>print <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印了test，返回值为nil</span>
</span></span><span style="display:flex;"><span>test <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">nil</span>
</span></span></code></pre></div><p>在<code>irb</code>中上面代码执行后会打印<code>test</code>，并紧跟着<code>=&gt; nil</code>。这是因为<code>print</code>除了打印，不会返回任何值，所以<code>print &quot;test&quot;</code>作为表达式的返回值为<code>nil</code>。</p>
<p>与许多其它编程语言不同，<code>Ruby</code>的<font color="#de7802">行尾不需要分号</font>（使用分号也是可以的，但通常不建议这样做）。对于有经验的程序员来说，一开始可能需要一点时间来适应，但对于新程序员来说，这个特性使<code>Ruby</code>更容易学习。</p>
<h1 id="the-variety-of-ruby-identifiers">The variety of Ruby identifiers</h1>
<h2 id="variables">Variables</h2>
<ul>
<li>
<p>局部变量：局部变量名以<font color="#de7802">小写字母或下划线开头，并由字母、下划线或数字组成</font>。例如：<code>x、string、abc、var1、start_value 和firstName</code>都是有效的局部变量名。但请注意，在<code>Ruby</code>中使用多个单词组合成局部变量名时通常<font color="#de7802">使用下划线而不是驼峰式命名法</font>。例如，一般使用<code>first_name</code>而不是<code>firstName</code>。</p>
</li>
<li>
<p>实例变量：在单个对象中存储信息的实例变量始终以<font color="#de7802">单个<code>@</code>符号开头</font>，其后包含与局部变量相同的字符集，例如<code>@age</code>和<code>@last_name</code>。虽然<font color=Blue>局部变量不能以大写字母开头，但实例变量名在<code>@</code>符号之后的第一个位置可以是大写字母</font>。但通常<code>@</code>符号后面的第一个字符是一个小写字母。</p>
</li>
<li>
<p>类变量：用于存储每个类层次结构的信息，它是以两个<code>@@</code>符号开头，其它与实例变量遵循相同的规则，例如，<code>@@running_total</code>。</p>
</li>
<li>
<p>全局变量可以通过它们的<font color="#de7802">前导美元符号来识别</font>。美元符号<font color="#de7802">后面的部分不遵循局部变量的命名约定</font>。例如，全局变量<code>$:, $1, $/,$stdin,$LOAD_PATH</code>都是合法的全局变量名。<font color=LightSeaGreen>只要以美元符号开头，它就是一个全局变量</font>。</p>
</li>
</ul>
<p>在<code>Ruby</code>中，常量<font color="#de7802">以大写字母开头</font>，例如<code>A, String, FirstName</code>和<code>STDIN</code>都是合法的常量名。在用多个单词组成常量名时，<code>Ruby</code>的惯例是**<font color=LightSeaGreen>使用驼峰大写字母（<code>FirstName</code>）或下划线分隔的全大写字母（<code>FIRST_NAME</code>）</font>**。</p>
<p>在<code>Ruby</code>中，有许多预定义的关键字。例如<code>def</code>（方法定义）、<code>class</code>（类定义）、<code>if</code>（条件）和<code>__FILE__</code>（当前正在执行文件名），这样的关键字大约有<code>40</code>个，它们通常都是比较简短的标识符。</p>
<p>在<code>Ruby</code>中，<font color="#de7802">方法名称遵循与局部变量相同的规则和惯例</font>（除了它们能以<code>?</code>、<code>!</code>或<code>=</code>结尾）。在某些情况下，<font color=LightSeaGreen>无法通过观察一个表达式来判断看到的是一个局部变量还是一个方法名</font>，因为调用方法时可以省略圆括号——<font color="#de7802">并且这是故意的</font>。</p>
<h2 id="object">Object</h2>
<p><code>Ruby</code>把所有的数据结构和值，从简单的标量值（如整数和字符串常量）到复杂的数据结构（如数组）<font color="#de7802">都看作是对象</font>。每个对象都能理解一组特定的消息，每个消息都直接对应一个方法。</p>
<p>对象或是由字面量表示，就像双引号中的字符串一样，或是由它们被绑定的变量表示。消息的发送是通过特殊的点运算符实现的：<font color=green>点右边的消息被发送到点左边的对象</font>。 实际上，还有其它更专业的方法来向对象发送消息，但点是最常见的基本方法。</p>
<p>在<code>Ruby</code>程序中，大部分的设计、逻辑和操作都围绕着对象进行。因此，在编写<code>Ruby</code>程序时，我们<font color="#de7802">主要的工作是创建对象，赋予它们能力，并要求它们执行一些操作</font>。</p>
<p><code>Ruby</code>通过程序语言设计原则「面向对象」来实现通过对象操作数据。在面向对象编程 (<code>OOP</code>) 中，通过创建对象并要求它们执行操作并为你提供信息，来执行计算、数据操作和输入/输出操作。</p>
<p>在大多数面向对象的语言（包括 <code>Ruby</code>）中，<font color="#de7802">每个对象都是特定类的实例</font>，并且单个对象的行为至少在某种程度上由对象类中的方法定义决定。</p>
<p>所有<code>Ruby</code>对象在创建时都具有某些先天的能力，即它们知道如何执行某些方法。下面创建了一个通用的对象，并定义了一个<code>talk</code>方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">obj</span><span style="color:#f92672">.</span><span style="color:#a6e22e">talk</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;I am an object.&#34;</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;(Do you object?)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><img src="https://s2.loli.net/2022/09/12/79TIwCE2jRDXrSF.png" alt="79TIwCE2jRDXrSF" style="zoom:67%;" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(name)  
</span></span><span style="display:flex;"><span>    set_name(name)  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>  
</span></span><span style="display:flex;"><span>    @first_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">+</span> @last_name  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_name</span>(name)  
</span></span><span style="display:flex;"><span>    first_name, last_name <span style="color:#f92672">=</span> name<span style="color:#f92672">.</span>split(<span style="color:#e6db74">/\s+/</span>)  
</span></span><span style="display:flex;"><span>    set_first_name(first_name)  
</span></span><span style="display:flex;"><span>    set_last_name(last_name)  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_first_name</span>(name)  
</span></span><span style="display:flex;"><span>    @first_name <span style="color:#f92672">=</span> name  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_last_name</span>(name)  
</span></span><span style="display:flex;"><span>    @last_name <span style="color:#f92672">=</span> name  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>person1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;name&#39;</span>)  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定义仅属于person1的方法</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">person1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">talk</span>  
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#39;talk&#39;</span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>person1<span style="color:#f92672">.</span>talk  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>person2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;test&#39;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># person2不能调用talk方法，因为talk方法只属于person1</span>
</span></span><span style="display:flex;"><span>person2<span style="color:#f92672">.</span>talk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>talk
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Uncaught</span> <span style="color:#e6db74">exception</span>: undefined method <span style="color:#e6db74">`talk&#39; for #&lt;Person:0x00007fece3188418 @first_name=&#34;test&#34;, @last_name=nil&gt;
</span></span></span></code></pre></div><p><code>Ruby</code>中的方法很像数学函数：输入，计算，然后得出一个结果。为了给<code>Ruby</code>方法提供输入，可以用一个或多个参数来调用该方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">obj</span><span style="color:#f92672">.</span><span style="color:#a6e22e">c2f</span>(c)
</span></span><span style="display:flex;"><span>  c <span style="color:#f92672">*</span> <span style="color:#ae81ff">9</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts obj<span style="color:#f92672">.</span>c2f(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>puts obj<span style="color:#f92672">.</span>c2f <span style="color:#ae81ff">100</span> <span style="color:#75715e">#可以不使用圆括号</span>
</span></span></code></pre></div><p>另一个值得注意的地方：当一个方法不需要参数时，定义时提供空圆括号是有效的<code>Ruby</code>语法，但*<font color=LightSeaGreen>更常见的做法是省略这一对圆括号</font>*：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">welcome_the_user</span>()
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Hi there!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">welcome_the_user</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Hi there!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>welcome_the_user()  
</span></span><span style="display:flex;"><span>welcome_the_user
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hi</span> there!
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hi</span> there!
</span></span></code></pre></div><p>在<code>Ruby</code>中，<strong><font color="#de7802">每个方法调用都是表达式</font></strong>。当调用一个方法时，该方法调用会被评估为某种结果，这个结果就是该方法的返回值。</p>
<p>任何方法的返回值都<font color="#de7802">与该方法执行过程中最后求值的表达式的值相同</font>。在温度转换方法<code>obj.c2f</code>中，最后求值的表达式是方法体的唯一一行<code>c * 9.0 / 5 + 32</code>，所以该表达式的值就是<code>obj.c2f</code>方法的返回值。</p>
<p><code>Ruby</code>可以使用关键字<code>return</code>来明确方法的返回值，但<font color="#de7802">这个关键字的使用通常是可选的</font>。它对于需要显式返回的场景很有用，其它情况均可以省略这个关键字：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">obj</span><span style="color:#f92672">.</span><span style="color:#a6e22e">c2f</span>(c)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> c <span style="color:#f92672">*</span> <span style="color:#ae81ff">9</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p><code>Ruby</code>中的<font color=Blue>每个表达式都会被评估为一个对象</font>，并且**<font color=LightSeaGreen>每个对象都有一个真值</font>**，几乎每个对象的真值都为<code>true</code>。唯一真值为<code>false</code>的是对象<code>false</code>和特殊的非实体对象<code>nil</code>。即在<code>Ruby</code>中，所有的东西都有一个布尔值，而有时它并不是我们所期望的那样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;abc&#34;</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;abc is true&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#ae81ff">123</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;123 is true&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;test&#34;</span> <span style="color:#66d9ef">unless</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># puts 作为表达式的返回值为nil，而nil的真值为false</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> puts <span style="color:#e6db74">&#34;You&#39;ll see this&#34;</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;but not this&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>abc is <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">123</span> is <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>test
</span></span></code></pre></div><p>即使是一个新创建的对象也不是一块白板。一个对象一旦被创建，它就能对一些消息作出反应，也就是说每个对象创建时都具有某些先天能力。下面是<code>Object</code>对象创建时先天具有的一些方法（<code>ruby</code>版本不同，输出的结果不同）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>p <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new<span style="color:#f92672">.</span>methods<span style="color:#f92672">.</span>sort
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>:<span style="color:#f92672">!</span>, :<span style="color:#f92672">!=</span>, :<span style="color:#f92672">!~</span>, <span style="color:#e6db74">:&lt;=&gt;</span>, <span style="color:#e6db74">:==</span>, <span style="color:#e6db74">:===</span>, :<span style="color:#f92672">=~</span>, <span style="color:#e6db74">:__id__</span>, <span style="color:#e6db74">:__send__</span>, <span style="color:#e6db74">:class</span>, <span style="color:#e6db74">:clone</span>, <span style="color:#e6db74">:define_singleton_method</span>, <span style="color:#e6db74">:display</span>, <span style="color:#e6db74">:do_stuff</span>, <span style="color:#e6db74">:dup</span>, <span style="color:#e6db74">:enum_for</span>, <span style="color:#e6db74">:eql?</span>, <span style="color:#e6db74">:equal?</span>, <span style="color:#e6db74">:extend</span>, <span style="color:#e6db74">:freeze</span>, <span style="color:#e6db74">:frozen?</span>, <span style="color:#e6db74">:hash</span>, <span style="color:#e6db74">:inspect</span>, <span style="color:#e6db74">:instance_eval</span>, <span style="color:#e6db74">:instance_exec</span>, <span style="color:#e6db74">:instance_of?</span>, <span style="color:#e6db74">:instance_variable_defined?</span>, <span style="color:#e6db74">:instance_variable_get</span>, <span style="color:#e6db74">:instance_variable_set</span>, <span style="color:#e6db74">:instance_variables</span>, <span style="color:#e6db74">:is_a?</span>, <span style="color:#e6db74">:itself</span>, <span style="color:#e6db74">:kind_of?</span>, <span style="color:#e6db74">:method</span>, <span style="color:#e6db74">:methods</span>, <span style="color:#e6db74">:nil?</span>, <span style="color:#e6db74">:object_id</span>, <span style="color:#e6db74">:pretty_inspect</span>, <span style="color:#e6db74">:pretty_print</span>, <span style="color:#e6db74">:pretty_print_cycle</span>, <span style="color:#e6db74">:pretty_print_inspect</span>, <span style="color:#e6db74">:pretty_print_instance_variables</span>, <span style="color:#e6db74">:private_methods</span>, <span style="color:#e6db74">:protected_methods</span>, <span style="color:#e6db74">:public_method</span>, <span style="color:#e6db74">:public_methods</span>, <span style="color:#e6db74">:public_send</span>, <span style="color:#e6db74">:remove_instance_variable</span>, <span style="color:#e6db74">:respond_to?</span>, <span style="color:#e6db74">:send</span>, <span style="color:#e6db74">:singleton_class</span>, <span style="color:#e6db74">:singleton_method</span>, <span style="color:#e6db74">:singleton_methods</span>, <span style="color:#e6db74">:taint</span>, <span style="color:#e6db74">:tainted?</span>, <span style="color:#e6db74">:tap</span>, <span style="color:#e6db74">:then</span>, <span style="color:#e6db74">:to_enum</span>, <span style="color:#e6db74">:to_s</span>, <span style="color:#e6db74">:trust</span>, <span style="color:#e6db74">:untaint</span>, <span style="color:#e6db74">:untrust</span>, <span style="color:#e6db74">:untrusted?</span>, <span style="color:#e6db74">:yield_self</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p><code>Ruby</code>中的每个对象都有一个唯一的<code>ID</code>与之关联。可以调用对象的<code>object_id</code>方法来查看对象的<code>id</code>。在下面的代码中，尽管<code>a</code>和<code>b</code>名字不同，但它们所指的对象都是相同的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;a&#39;s id is </span><span style="color:#e6db74">#{</span>a<span style="color:#f92672">.</span>object_id<span style="color:#e6db74">}</span><span style="color:#e6db74"> and b&#39;s id is </span><span style="color:#e6db74">#{</span>b<span style="color:#f92672">.</span>object_id<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;The id of obj is </span><span style="color:#e6db74">#{</span>obj<span style="color:#f92672">.</span>object_id<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Strings are objects too, and this is a string!&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;The id of the string object str is </span><span style="color:#e6db74">#{</span>str<span style="color:#f92672">.</span>object_id<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span> 
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;And the id of the integer 100 is </span><span style="color:#e6db74">#{</span><span style="color:#ae81ff">100</span><span style="color:#f92672">.</span>object_id<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>  
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;And the id of var c is </span><span style="color:#e6db74">#{</span>c<span style="color:#f92672">.</span>object_id<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>string_1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>string_2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;string_1&#39;s id is </span><span style="color:#e6db74">#{</span>string_1<span style="color:#f92672">.</span>object_id<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;string_2&#39;s id is </span><span style="color:#e6db74">#{</span>string_2<span style="color:#f92672">.</span>object_id<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a<span style="color:#e6db74">&#39;s id is 840 and b&#39;</span>s id is <span style="color:#ae81ff">840</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">The</span> id of obj is <span style="color:#ae81ff">860</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">The</span> id of the string object str is <span style="color:#ae81ff">880</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">And</span> the id of the integer <span style="color:#ae81ff">100</span> is <span style="color:#ae81ff">201</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">And</span> the id of var c is <span style="color:#ae81ff">201</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>string_1<span style="color:#e6db74">&#39;s id is 900.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">string_2&#39;</span>s id is <span style="color:#ae81ff">920</span><span style="color:#f92672">.</span>
</span></span></code></pre></div><p>上面的示例代码中，虽然<code>string_1</code>和<code>string_2</code>包含相同的字符串，但它们调用<code>object_id</code>方法后的返回值是不同，所以它们是不同的对象。在<code>Ruby</code>中<font color="#de7802">赋予对象<code>ID</code>编号的作用之一是能够用它进行唯一标识</font>，特别是能够确定两个对象是否为同一个对象。</p>
<p>如果有两个字符串，可以测试它们是否包含相同的字符，也可以测试它们是否为同一个对象。正如上面的示例代码，即使它们包含相同的字符，也不一定是同一个对象。</p>
<p><code>Ruby</code>提供了多种方法来比较不同类型对象的相等性，比较对象<code>ID</code>是否相等只是衡量对象相等性的一种方法。现在，我们转向先天方法列表中的下一个方法：<code>respond_to?</code>。在下面的代码中在发送<code>talk</code>消息时，可以先检查对象是否对<code>talk</code>响应：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> obj<span style="color:#f92672">.</span>respond_to?(<span style="color:#e6db74">&#34;talk&#34;</span>)
</span></span><span style="display:flex;"><span>  obj<span style="color:#f92672">.</span>talk
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Sorry, the object doesn&#39;t understand the &#39;talk&#39; message.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>实际上<code>respond_to?</code>方法是<code>introspection</code>或<code>reflection</code>，这两个术语指的是在程序运行时检查程序的状态, <code>Ruby</code>提供了许多用于<code>introspection</code>的工具。使用方法检查某个方法是否为对象的方法就是一种<code>introspection</code>或<code>reflection</code>技术。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ticket<span style="color:#f92672">.</span>respond_to?(request)
</span></span><span style="display:flex;"><span>  puts ticket<span style="color:#f92672">.</span>send(request)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;No such information available&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p><code>send</code>是一个广泛的概念：电子邮件被发送，数据被发送到<code>I/O</code>套接字等等。对于程序来说，定义一个叫做<code>send</code>的方法，与<code>Ruby</code>内置的<code>send</code>方法相冲突是很常见的事情。</p>
<p>因此，<code>Ruby</code>内置了<code>send</code>的一个替代方法<code>__send__</code>。一般来说，不会有人用这个名字定义一个新方法，所以内置的版本总是可用的。这看起来很奇怪，但从方法名称冲突的角度来看，比普通的<code>send</code>版本更安全。</p>
<p>此外，还有一个安全的，但方式不同的<code>send</code> 版本，叫做<code>public_send</code>方法。<font color="#de7802">普通<code>send</code>和<code>public_send</code>的区别在于<code>send</code>可以调用对象的私有方法，而<code>public_send</code>不能</font>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> person2<span style="color:#f92672">.</span>respond_to?(<span style="color:#e6db74">&#34;talk&#34;</span>)  
</span></span><span style="display:flex;"><span>  person2<span style="color:#f92672">.</span>__send__(<span style="color:#e6db74">&#39;talk&#39;</span>)  
</span></span><span style="display:flex;"><span>  person2<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;talk&#39;</span>)  
</span></span><span style="display:flex;"><span>  person2<span style="color:#f92672">.</span>public_send(<span style="color:#e6db74">&#39;talk&#39;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>  
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Sorry, the object doesn&#39;t understand the &#39;talk&#39; message.&#34;</span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>很多情况下使用点操作符来发送消息。但是，替代方法<code>send</code>可能是有用和强大的，也很容易出错，以至于几乎总是需要先调用<code>response_to?</code>方法。</p>
<p>如果从用户那里获取输入信息，并使用它来调用方法，这可能会出现意想不到的行为，甚至是恶意的攻击。指导原则是<font color="#de7802">要小心向对象发送任意的消息，特别是当这些消息是基于用户的选择或输入时</font>。</p>
<p>当调用方法时，必须提供正确数目的实参，如果提供错误数目的实参，则会出现编译错误。下面<code>one_arg</code>方法只接受一个参数，若调用该方法时多于一个实参时就会出现编译错误：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">obj</span><span style="color:#f92672">.</span><span style="color:#a6e22e">one_arg</span>(x)
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;I require one and only one argument!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>obj<span style="color:#f92672">.</span>one_arg(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Uncaught</span> <span style="color:#e6db74">exception</span>: wrong number of arguments (given <span style="color:#ae81ff">3</span>, expected <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p>如果想要一个方法接受多个参数，可以在参数前面加一个<code>*</code>前缀。下面的方法<code>multi_args</code>调用的时候可以传<code>0</code>个或多个参数：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">obj</span><span style="color:#f92672">.</span><span style="color:#a6e22e">multi_args</span>(<span style="color:#f92672">*</span>x)
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;I can take zero or more arguments! </span><span style="color:#e6db74">#{</span>x<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>obj<span style="color:#f92672">.</span>multi_args(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">56</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>obj<span style="color:#f92672">.</span>multi_args(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>I can take zero <span style="color:#f92672">or</span> more arguments! <span style="color:#f92672">[</span><span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">56</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>I can take zero <span style="color:#f92672">or</span> more arguments! <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">two_or_more</span>(a, b, <span style="color:#f92672">*</span>c)
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;I require two or more arguments!&#34;</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;And sure enough, I got: &#34;</span>
</span></span><span style="display:flex;"><span>  p a, b, c
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>two_or_more(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>I require two <span style="color:#f92672">or</span> more arguments!
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">And</span> sure enough, I <span style="color:#e6db74">got</span>: 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>方法定义时的某些参数也可以有默认值。下面方法<code>default_args</code>定义时增加了第三个参数<code>c</code>，一个带有默认值的参数：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">default_args</span>(a, b, c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Values of variables: &#34;</span>, a, b, c
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>default_args(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Values</span> of <span style="color:#e6db74">variables</span>: 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>在方法调用时，各类参数解析有一定的规则：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mixed_args</span>(a, b, <span style="color:#f92672">*</span>c, d)
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Arguments:&#34;</span>
</span></span><span style="display:flex;"><span>  p a, b, c, d
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mixed_args(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mixed_args(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span></code></pre></div><p>下图提供了一个参数分配逻辑的图形表示。参数分配的优先级顺序为：<strong><font color="#de7802">首先处理必需的参数，然后是默认值的可选参数，最后是可变参数</font></strong>：</p>
<img src="https://s2.loli.net/2022/10/22/W8ViKClYHBzbwFd.png" alt="W8ViKClYHBzbwFd" style="zoom:56%;" />
<p>也就是说，<font color="#de7802">所有参数都是有顺序的</font>。必须的参数具有最高优先权，无论它们出现在参数列表的左边还是右边，<strong><font color="#de7802">所有默认值参数必须出现在中间</font></strong>，必须参数可以放在两边：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">broken_args</span>(x, <span style="color:#f92672">*</span>y, z <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>syntax error, unexpected <span style="color:#e6db74">&#39;=&#39;</span>, expecting <span style="color:#e6db74">&#39;)&#39;</span>
</span></span></code></pre></div><img src="https://s2.loli.net/2022/10/22/KeiPxsyvCd89toE.png" alt="KeiPxsyvCd89toE" style="zoom:50%;" />
<h2 id="local-variables-and-variable-assignment">Local variables and variable assignment</h2>
<p>局部变量以<font color="#de7802">小写字母或下划线开始，并且以字母、数字和下划线组成</font>。下面都是合法的局部变量名：<code>x,_x,name,firs_name,plan9,user_ID,_</code>。局部的意思是仅在程序的有限部分可见，惯用命名法是下划线而非驼峰命名：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">say_goodbye</span>
</span></span><span style="display:flex;"><span>  x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Goodbye&#34;</span>
</span></span><span style="display:flex;"><span>  puts x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start_here</span>
</span></span><span style="display:flex;"><span>  x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>  puts x
</span></span><span style="display:flex;"><span>  say_goodbye
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Let&#39;s check whether x remained the same:&#34;</span>
</span></span><span style="display:flex;"><span>  puts x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start_here
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hello</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Goodbye</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Let</span><span style="color:#960050;background-color:#1e0010">&#39;</span>s check whether x remained the <span style="color:#e6db74">same</span>:
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hello</span>
</span></span></code></pre></div><p>变量赋值给人的感觉是使左边的变量被设置为右边的对象:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span></code></pre></div><p>下面代码中，虽然只是替换了变量<code>str</code>的值，但是变量<code>abc</code>的值也被替换了。这是因为<font color="#de7802">变量不持有对象的值，只是对象的引用</font>，因此<code>str</code>只是<code>string</code>对象的引用。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">say_goodbye</span>
</span></span><span style="display:flex;"><span>  str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>  abc <span style="color:#f92672">=</span> str
</span></span><span style="display:flex;"><span>  str<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;Goodbye&#34;</span>)
</span></span><span style="display:flex;"><span>  puts str
</span></span><span style="display:flex;"><span>  puts abc
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>say_goodbye
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># str和abc的结果一样</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Goodbye</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Goodbye</span>
</span></span></code></pre></div><p>在一次赋值中，如果左边是变量名，右边是一个对象，那么<font color=Blue>该变量收到的是该对象的一个引用</font>。但在一个变量到另一个变量的赋值中（<code>abc = str</code>），<font color="#de7802">左边的变量收到了储存在右边变量中的引用的副本，结果两个变量现在都指向同一个对象的引用</font>。</p>
<p>在<code>Ruby</code>中<font color=LightSeaGreen>有些对象是作为即时值存储在变量中的</font>。这些<font color=red>对象包括整数、符号（看起来像<code>:this</code>），以及特殊对象<code>true、false</code>和<code>nil</code></font>。当把这些值赋给给一个变量时（例如<code>x = 1</code>），<font color=LightSeaGreen>那么该变量持有该值本身，而不是对它的引用</font>。</p>
<p>但是即时值表示规则有几个有趣的变化，特别是当它涉及到整数时。首先，<strong><font color="#de7802">任何被表示为即时值的对象都是完全相同的对象，无论它被赋值到多少个变量</font></strong>。例如，只有一个对象<code>100</code>，只有一个对象<code>false</code>，以此类推。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>object_id
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>puts y<span style="color:#f92672">.</span>object_id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#x和y的对象id是一样的</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>  
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>  
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>object_id  
</span></span><span style="display:flex;"><span>puts y<span style="color:#f92672">.</span>object_id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#x和y的对象id是一样的</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>整数绑定变量后导致的直接结果是<code>Ruby</code><font color="#de7802">缺乏前置和后置递增运算符</font>。也就是说，不能在<code>Ruby</code>中进行如下方式操作整数变量：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>syntax error, unexpected <span style="color:#66d9ef">end</span><span style="color:#f92672">-</span>of<span style="color:#f92672">-</span>input
</span></span></code></pre></div><p>对于<code>Ruby</code>中的每个对象，<font color="#de7802">有且必须有一个或多个指向该对象的引用</font>。如果没有指向该对象的引用，那么该对象被认为是失效的，其内存空间就会被回收并重新使用。</p>
<p>如果有两个或更多的变量指向同一个对象，可以在<font color=Blue>平等的基础上</font>使用其中的任何一个变量来向该对象发送消息。<font color=red>引用与它们的对象可以是多对一的关系</font>，如果把一个全新的对象分配给一个已经指向另一个对象的变量，事情就会发生变化：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>abc <span style="color:#f92672">=</span> str
</span></span><span style="display:flex;"><span>str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Goodbye&#34;</span>
</span></span><span style="display:flex;"><span>puts str
</span></span><span style="display:flex;"><span>puts abc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">//</span> <span style="color:#960050;background-color:#1e0010">执行结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Goodbye</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hello</span>
</span></span></code></pre></div><p>在上面的代码中，给<code>str</code>第二次赋值时用了一个完全不同的对象。此后，<code>str</code>便指向了新的对象，但<code>abc</code>依然指向旧的对象。</p>
<p>上面这些例子使用局部变量来演示当赋值给一个已经被赋值的变量时会发生什么。但在这里看到的规则和行为<font color="#de7802">并不只是针对局部变量，类、全局和实例变量都遵循同样的规则</font>。</p>
<p>与静态语言不同，<code>Ruby</code>变量没有类型，<em><font color="#de7802">任何变量都可以在任何时候被绑定到任何类型的任何对象上</font></em>。因此，引用和（再）赋值的语义对调用一个带参数方法时有重要影响。该方法会收到什么？该方法能用它做什么？</p>
<h2 id="references-and-method-arguments">References and method arguments</h2>
<p>下面代码表明在<code>change_string</code>方法中，变量<code>str</code>被分配了一个指向字符串的引用。一旦方法持有了一个引用，<font color="#de7802"><strong>它通过该引用对该对象所做的任何改变都是对其它引用都是可见的</strong></font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">change_string</span>(str)
</span></span><span style="display:flex;"><span>  str<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;New string content!&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Original string content!&#34;</span>
</span></span><span style="display:flex;"><span>puts s
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 方法中会改变传过来的参数</span>
</span></span><span style="display:flex;"><span>change_string(s)
</span></span><span style="display:flex;"><span>puts s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">//</span> <span style="color:#960050;background-color:#1e0010">执行结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Original</span> string content!
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">New</span> string content!
</span></span></code></pre></div><p>如果想保护对象不在方法中被改变，可以使用<code>dup</code>方法，该方法可以复制一个对象：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">change_string</span>(str)
</span></span><span style="display:flex;"><span>  str<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;New string content!&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Original string content!&#34;</span>
</span></span><span style="display:flex;"><span>puts s
</span></span><span style="display:flex;"><span>change_string(s<span style="color:#f92672">.</span>dup)
</span></span><span style="display:flex;"><span>puts s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Original</span> string content!
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Original</span> string content!
</span></span></code></pre></div><p>也可以冻结一个对象，这样可以防止它发生进一步变化:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">change_string</span>(str)
</span></span><span style="display:flex;"><span>  str<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;New string content!&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Original string content!&#34;</span>
</span></span><span style="display:flex;"><span>puts s
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>freeze
</span></span><span style="display:flex;"><span>change_string(s)
</span></span><span style="display:flex;"><span>puts s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Uncaught</span> <span style="color:#e6db74">exception</span>: can<span style="color:#960050;background-color:#1e0010">&#39;</span>t modify frozen String: <span style="color:#e6db74">&#34;Original string content!&#34;</span>
</span></span></code></pre></div><p>需要注意的是，<font color="#de7802"><code>freeze</code>是永久的，但没有对应的<code>unfreeze</code>方法</font>。还有一个方法叫<code>clone</code>，它很像<code>dup</code>，不同的是，如果<code>clone</code>一个冻结的对象，<code>clone</code>后的新对象也会被冻结。如果<code>dup</code>一个冻结的对象，<code>dup</code>后的新对象不会被冻结。</p>
<p>对于<font color="#de7802">数组而言，即使调用了<code>freeze</code>方法，数组里面的对象仍然可能被改变</font>，并且这是合法的。下面的代码不会产生编译错误：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>numbers <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;one&#34;</span>, <span style="color:#e6db74">&#34;two&#34;</span>, <span style="color:#e6db74">&#34;three&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>numbers<span style="color:#f92672">.</span>freeze
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 虽然数组本身被冻结了，但还可以改变数组中的某个元素</span>
</span></span><span style="display:flex;"><span>numbers<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">].</span>replace(<span style="color:#e6db74">&#34;four&#34;</span>)
</span></span><span style="display:flex;"><span>p numbers <span style="color:#e6db74">//</span> <span style="color:#960050;background-color:#1e0010">执行结果</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;one&#34;</span>, <span style="color:#e6db74">&#34;two&#34;</span>, <span style="color:#e6db74">&#34;four&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>numbers <span style="color:#f92672">=</span> <span style="color:#e6db74">%w[one two three]</span>
</span></span><span style="display:flex;"><span>numbers<span style="color:#f92672">.</span>freeze
</span></span><span style="display:flex;"><span>numbers<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">].</span>replace(<span style="color:#e6db74">&#34;four&#34;</span>)
</span></span><span style="display:flex;"><span>p numbers  <span style="color:#e6db74">//</span> <span style="color:#960050;background-color:#1e0010">执行结果</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;one&#34;</span>, <span style="color:#e6db74">&#34;two&#34;</span>, <span style="color:#e6db74">&#34;four&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>数组调用<code>freeze</code>的意思是不能改变数组，即指向数组对象的引用不能再被赋值。但是，<font color="#de7802">数组里面的某个对象还是可以被改变的</font>。</p>
<h2 id="local-variables-and-the-things-that-look-like-them">Local variables and the things that look like them</h2>
<p>当<code>Ruby</code>看到一个普通的单词（裸词标识符），例如<code>s、ticket、puts</code>或<code>user_name</code>这些词，会将其理解为下面三种情况之一：</p>
<ul>
<li>局部变量</li>
<li>关键字</li>
<li>方法调用</li>
</ul>
<p>关键字是特殊的保留字，不能用它们作为变量名。在<code>Ruby</code>中方法调用可以是普通的单词（不包含圆括号），或者是一对圆括号中包含参数列表。如果普通单词后面跟上一对圆括号，显然不是局部变量。对于其它情况，可能会有一些含糊不清的地方，<code>Ruby</code>必须弄清楚：</p>
<ul>
<li>如果标识符是一个关键字，<code>Ruby</code>能够识别到（<code>Ruby</code>有一个内部关键字列表）。</li>
<li>如果标识符的右边有一个等号（=），那么它就是一个正在进行赋值的变量。</li>
<li>否则，标识符会被认为是一个局部变量或方法调用。<code>Ruby</code>解释器对*<font color="#de7802">这两者的处理方式是相同的</font>*。</li>
</ul>
<p><code>Ruby</code>将<code>call</code>推测到的局部变量或方法，这会导致标识符被评估。如果使用的标识符不是上面列出的三种中的任何一种，那么<code>Ruby</code>将以致命错误停止执行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>ruby <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#34;x&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Traceback</span> (most recent call last):
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span><span style="color:#e6db74">e</span>:<span style="color:#ae81ff">1</span><span style="color:#e6db74">:in</span> <span style="color:#e6db74">`&lt;main&gt;&#39;: undefined local variable or method `</span>x<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">for</span> <span style="color:#e6db74">main</span>:<span style="color:#66d9ef">Object</span> (<span style="color:#66d9ef">NameError</span>)
</span></span></code></pre></div><h1 id="organizing-objects-with-classes">Organizing objects with classes</h1>
<p>使用<code>Object.new</code>创建一个新的对象，并<font color="#de7802">为这个对象创建它自己的方法</font>，一次定义一个新方法，这是感受<code>Ruby</code>以对象为中心编程的一个好方法。</p>
<p>定义一个类可以把方法组合成一个通用集合，这样就可以快速创建许多行为基本相同的对象。虽然可以为单个对象添加方法，但<font color="#de7802">如果把我们的领域建模为类，就不必对每个对象都这样做了</font>。</p>
<p>在<code>Ruby</code>中处理的所有东西要么是一个对象，要么是一个可以评估为对象的结构体，而每个对象都是某个类的实例。整数是一个类的实例，而类本身就是对象。</p>
<p>一个典型的类是由方法定义的集合组成的。类的存在通常是为了被实例化，也就是说，创建的对象是类的实例。例如，之前创建了一个类的实例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new
</span></span></code></pre></div><p>实际上<code>Object</code>是一个内置类，当在一个类上使用点符号时，就是向该类发送了一条消息。类可以响应消息，就像对象一样。事实上，类就是对象，<code>new</code>方法是一个构造函数，这个方法的目的是制造并返回给一个新的实例。</p>
<p>可以使用<code>class</code>关键字来定义一个类，<font color="#de7802">类的命名规则和常量的一致</font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Ticket</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">event</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Can&#39;t really be specified yet...&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>现在可以创建一个新的<code>Ticket</code>类的实例，并能够调用<code>event</code>方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>ticket <span style="color:#f92672">=</span> <span style="color:#66d9ef">Ticket</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>puts ticket<span style="color:#f92672">.</span>event
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Can</span><span style="color:#960050;background-color:#1e0010">&#39;</span>t really be specified yet<span style="color:#f92672">...</span>
</span></span></code></pre></div><p>为一个特定对象定义的方法，例如<code>def ticket.price</code>被称为<font color=red>单子方法</font>。在一个类中定义一个实例方法后，没有什么可以阻止再次定义它。也就是说，<font color="#de7802">新定义的实例方法会覆盖之前定义的方法</font>。</p>
<p>下面的类<code>C</code>定义了两个<code>m</code>方法，新的版本会优先使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">m</span> 
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;First definition of method m&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">m</span> 
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Second definition of method m&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>C<span style="color:#f92672">.</span>new<span style="color:#f92672">.</span>m <span style="color:#e6db74">//</span> <span style="color:#960050;background-color:#1e0010">调用方法</span>m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">//</span> <span style="color:#960050;background-color:#1e0010">执行结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Second</span> definition of method m
</span></span></code></pre></div><p>实例变量使单个对象能够记住状态，它的工作方式与其它变量很相似。可以给它们赋值，然后读取这些值，把它们加在一起，打印出来等等。但实例变量有一些区别：</p>
<ul>
<li>实例变量名称总是以一个<code>@</code>开始。</li>
<li>实例变量只对它们所属的对象可见。(「对一个对象可见」有一个技术上的定义，与默认的对象<code>self</code>有关)。</li>
<li>在一个类方法中初始化的实例变量可以被该类中定义的任何实例方法使用。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_name</span>(string)
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Setting person&#39;s name...&#34;</span>
</span></span><span style="display:flex;"><span>    @name <span style="color:#f92672">=</span> string
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_name</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Returning the person&#39;s name...&#34;</span>
</span></span><span style="display:flex;"><span>    @name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>joe <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>joe<span style="color:#f92672">.</span>set_name(<span style="color:#e6db74">&#34;Joe&#34;</span>)
</span></span><span style="display:flex;"><span>puts joe<span style="color:#f92672">.</span>get_name
</span></span></code></pre></div><p>当编写一个类（如<code>Ticket</code>）时，如果我们愿意，可以定义一个特殊的方法，称为<code>initialize</code>。如果这样做了，每次创建一个新的类的实例时，这个方法就会被自动调用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Ticket</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Creating a new ticket!&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Ticket</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">//</span> <span style="color:#960050;background-color:#1e0010">执行结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Creating</span> a <span style="color:#66d9ef">new</span> ticket!
</span></span></code></pre></div><p>当需要在程序中的某个点设置或改变一个对象的状态，而不是初始化方法时，问题的核心是为实例变量赋值（或重新赋值）。当然，可以在任何方法中改变任何实例变量的值。例如，如果想让门票具有打折的能力，可以在<code>Ticket</code>类的定义中写一个实例方法:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">discount</span>(percent)
</span></span><span style="display:flex;"><span>  @price <span style="color:#f92672">=</span> @price <span style="color:#f92672">*</span> (<span style="color:#ae81ff">100</span> <span style="color:#f92672">-</span> percent) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><h1 id="data-expressions-and-flow-control">Data, Expressions, and Flow Control</h1>
<p>计算机程序几乎所有的时间都在操作数据或等待数据从其它地方送达。当输入文字、短语和数字，听音乐，看视频时计算机进行计算，作出决定，并向我们传递信息。要编写计算机程序，必须先了解数据及其操作的基本知识。</p>
<h2 id="numbers-and-expressions">Numbers and Expressions</h2>
<p>编程时，表达式是数据（例如数字或字符串）、运算符（例如<code>+</code>或<code>-</code>）和变量的组合。当计算机理解这些表达式时，会产生某种形式的结果。<code>Ruby</code>代码是由表达式组成的，每个表达式都会被评估为一个特定的值：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">100</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">+</span> y
</span></span></code></pre></div><p>变量是占位符或对象的引用，包括数字、文本或创建的任何类型的对象。可以随心所欲地命名变量，只是有一些限制，必须满足下面<code>3</code>个条件：</p>
<ul>
<li>变量名称必须是一个单元（中间不能有空格）。</li>
<li>必须以字母或下划线开头，不能以数字开头。</li>
<li>必须只包含字母、数字或下划线，<font color="#de7802">并且区分大小写</font>。</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">变量名</th>
<th style="text-align:left">是否有效</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">x</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">Y2</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">_x</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">7x</td>
<td style="text-align:left">否，字母开头</td>
</tr>
<tr>
<td style="text-align:left">this_is_a_test</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">this is a test</td>
<td style="text-align:left">否，包含空格</td>
</tr>
<tr>
<td style="text-align:left">this&rsquo;is@a&rsquo;test!</td>
<td style="text-align:left">否，包含特殊字符‘，@，！</td>
</tr>
<tr>
<td style="text-align:left">this-is-a-test</td>
<td style="text-align:left">否，包含特殊字符-</td>
</tr>
</tbody>
</table>
<p>由于变量是值和数据的占位符，因此它们也可以用某个表达式的结果进行赋值（例如<code>x = 2 - 1</code>）并将其用于表达式本身（例如<code>x - y + 2</code>）。</p>
<p>没有逻辑的程序仅仅是一个计算器。计算机不只是对数据进行单一操作，还使用逻辑来决定不同的行动方案。逻辑的一个基本形式是在表达式中使用比较运算符来做决定:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>age <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> 
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;You&#39;re too young to use this system&#34;</span> <span style="color:#66d9ef">if</span> age <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>age <span style="color:#f92672">=</span> <span style="color:#ae81ff">24</span> 
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;You&#39;re NOT a teenager&#34;</span> <span style="color:#66d9ef">unless</span> age <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">12</span> <span style="color:#f92672">&amp;&amp;</span> age <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">20</span>
</span></span></code></pre></div><p><code>Ruby</code>提供了另一个更方便的<code>between?</code>方法。如果对象等于两个提供的边界值，或介于它们之间，会返回<code>true</code>，否则返回<code>false</code>。例如，在处理整数时，<code>age.between?(13, 19)</code>相当于<code>age &gt;= 13 &amp;&amp; age &lt;= 19</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>age <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;You&#39;re a teenager&#34;</span> <span style="color:#66d9ef">if</span> age<span style="color:#f92672">.</span>between?(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">20</span>)
</span></span></code></pre></div><h2 id="puts和print的区别">puts和print的区别</h2>
<p>函数<code>puts</code>输出<font color="#de7802">内容后会自动将光标移动到下一行</font>，而<code>print</code>不会。在下面的代码中，<code>print</code>输出内容后不会换行，所以使用<code>puts</code>输出时<code>world</code>将紧接着<code>hello</code>，然后换行，最后输出<code>test</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;hello &#34;</span>)
</span></span><span style="display:flex;"><span>puts(<span style="color:#e6db74">&#34;world&#34;</span>)
</span></span><span style="display:flex;"><span>puts(<span style="color:#e6db74">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># hello world</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># test</span>
</span></span></code></pre></div><h2 id="looping-through-numbers-with-blocks-and-iterators">Looping Through Numbers with Blocks and Iterators</h2>
<p>在下面的代码中，首先取了<code>5</code>，然后调用<code>times</code>方法（这个方法对于所有的数值类型都适用）。不是向这个方法传递数据，而是向它传递代码：<code>do</code>和<code>end</code>之间的代码。然后，<code>times</code>方法将会连续使用该代码5次:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#ae81ff">5</span><span style="color:#f92672">.</span>times <span style="color:#66d9ef">do</span> puts <span style="color:#e6db74">&#34;Test&#34;</span> <span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>另一种写法是<font color="#de7802">用花括号代替<code>do</code>和<code>end</code></font>。尽管<font color="#de7802">鼓励<code>do</code>和<code>end</code>用于多行代码块，但花括号使代码在单行上更易于阅读</font>。因此，下面代码执行后结果完全相同：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#ae81ff">5</span><span style="color:#f92672">.</span>times { puts <span style="color:#e6db74">&#34;Test&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span><span style="color:#f92672">.</span>times { puts _1 }
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>
</span></span></code></pre></div><p>也就说，对于<font color="#de7802">单行代码建议使用花括号，但对较长的代码块建议使用<code>do</code>和<code>end</code></font>。这是一个很好的习惯，几乎所有专业的<code>Ruby</code>开发者都遵循这种风格。</p>
<p>在<code>Ruby</code>中，有一种创建循环的机制称为迭代器，一个迭代器是逐个遍历项目列表中的东西。还有其它迭代器可用于数值类型，下面是<code>3</code>个常用的迭代器：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>upto(<span style="color:#ae81ff">5</span>) { <span style="color:#f92672">...</span>code to <span style="color:#66d9ef">loop</span> here<span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span><span style="color:#f92672">.</span>downto(<span style="color:#ae81ff">5</span>) { <span style="color:#f92672">...</span>code to <span style="color:#66d9ef">loop</span> here<span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span><span style="color:#f92672">.</span>step(<span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">5</span>) { <span style="color:#f92672">...</span>code to <span style="color:#66d9ef">loop</span> here<span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>upto(<span style="color:#ae81ff">5</span>) { puts _1 }
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span><span style="color:#f92672">.</span>downto(<span style="color:#ae81ff">7</span>) { puts _1 }
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span><span style="color:#f92672">.</span>step(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">6</span>) { puts _1 }
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">30</span><span style="color:#f92672">.</span>step(<span style="color:#ae81ff">10</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>) { puts _1 }
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">26</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span> 
</span></span></code></pre></div><p>目前为止还不知道每一步迭代的数字，以便能在循环的代码中使用当前迭代次数做一些其它事情。刚才讲解的所有迭代器都会自动将当前迭代的状态作为参数传递给循环代码，可以将其提取到一个变量中使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>upto(<span style="color:#ae81ff">5</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>number<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  puts number
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span><span style="color:#f92672">.</span>downto(<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  puts i
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>step(<span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  puts i
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span><span style="color:#f92672">.</span>times <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  puts i
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>需要注意的是，有些方法会执行代码块并传递数据，然后这些数据能够捕获到变量中。在上面示例代码中，对整数可用的<code>upto</code>方法将每次迭代的值传递到代码块中，我们将其<code>captured</code>到变量<code>number</code>中，以便在代码中使用。</p>
<h2 id="floating-point-numbers">Floating Point Numbers</h2>
<p>默认情况下，<code>Ruby</code>将任何没有小数点的数字视为整数。当使用<code>10 / 3</code> 时，实际上是要求<code>Ruby</code>将两个整数相除，而<code>Ruby</code>会给出一个整数作为结果。因此，下面的代码运行后的结果为<code>3</code>，而不是<code>3.333</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#ae81ff">10</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>
</span></span></code></pre></div><p>如果将代码做一些小小地改动：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#ae81ff">10</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#ae81ff">10</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#ae81ff">10</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>那么，上面<code>3</code>个表达式输出的结果将会是<code>3.3333333333333335</code>。上面的代码中<code>Ruby</code>处理<code>Float</code>类型的数字对象，并返回一个<code>Float</code>，并提供期望的精度级别。</p>
<p>在某些情况下，无法控制传入的数字，但仍希望将它们被视为浮点数。考虑下面这种情况，用户输入两个要除的数字，而这些数字需要一个精确的结果：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>puts x <span style="color:#f92672">/</span> y
</span></span></code></pre></div><p>上面代码中两个输入数字都是整数，所以结果只会是一个整数。幸运的是，<font color="#de7802">整数有一种特殊的方法可以即时将自身转换为浮点数</font>，只需像下面这样重写代码即可：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>to_f <span style="color:#f92672">/</span> y
</span></span></code></pre></div><p>相似地，浮点数也可以转换为整型，只要使用<code>to_i</code>方法即可：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts(<span style="color:#ae81ff">5</span><span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">.</span>to_i)
</span></span><span style="display:flex;"><span>puts(<span style="color:#ae81ff">5</span><span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">.</span>to_int)
</span></span></code></pre></div><h2 id="constants">Constants</h2>
<p>考虑一些永远不会改变的值——例如<code>pi</code>的值，这些不变的值称为常量。在<code>Ruby</code>中可以用<font color="#de7802">以大写字母开头的变量名</font>来表示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">Pi</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">.</span><span style="color:#ae81ff">141592</span>
</span></span></code></pre></div><p>如果尝试改变<code>Pi</code>的值，虽然目前是可以的，但编译器会产生警告<code>already initialized constant Pi</code>。需要注意的是这种情况不是编译错误，只是一个警告。</p>
<p>实际上，目前在<code>Ruby</code>中可以改变常量的值，但编译器会发出明确的警告信息。将来，<code>Ruby</code><font color=LightSeaGreen>可能会对常量实施更严格的控制</font>，因此请尊重这种使用方式，<font color="#de7802">尽量不要在程序中给常量重新赋值</font>。</p>
<h2 id="text-and-strings">Text and Strings</h2>
<p>字符串是任意长度的文本字符（包括数字、字母、空格和符号）的集合。<code>Ruby</code>中的所有字符串都是<code>String</code>类型，可以通过调用字符串的<font color=red>类方法<code>class</code></font>来证实：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Hello world&#34;</span><span style="color:#f92672">.</span>class
</span></span><span style="display:flex;"><span><span style="color:#75715e"># String</span>
</span></span></code></pre></div><p>如同数值类型，字符串也可以使用操作符：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Test&#34;</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;String&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Success!&#34;</span> <span style="color:#66d9ef">if</span> x <span style="color:#f92672">+</span> y <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;TestString&#34;</span>
</span></span></code></pre></div><p>使用<font color=red>双引号仅适用单行字符串</font>，如果想要字符串文本跨越多行，可以使用如下方式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">%q{This is a test of
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">the multi line
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">capabilities}</span>
</span></span><span style="display:flex;"><span>puts x
</span></span></code></pre></div><p>在上面的例子中，<font color=red>多行字符串以<code>%q{}</code>包裹</font>。实际上分隔符花括号是非必须的，也可以使用<code>&lt;</code>和<code>&gt;</code>，或<code>（</code>和<code>）</code>，或者简单地使用自己选择的其它两个定界符，例如<code>！</code>和<code>！</code>。下面这段代码将以完全相同的方式工作：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">%q!This is a test of
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">the multi line
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">capabilities!</span>
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">%q+This is a test of
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">the multi line
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">capabilities+</span>
</span></span><span style="display:flex;"><span>puts x
</span></span></code></pre></div><p>如果使用感叹号作为分隔符，那么字符串文本中的<font color=Blue>任何感叹号都会导致多行字符串提前结束</font>，<code>Ruby</code>会认为剩余的字符串文本都是错误的，所以<font color="#de7802">应该谨慎地选择分隔符</font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">%q!This is a test of
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">the multi line!</span>
</span></span><span style="display:flex;"><span>capabilities!
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Uncaught exception: undefined method `capabilities!&#39; for main:Object</span>
</span></span></code></pre></div><p>构建多行字符串字面量的另一种方法是使用<code>here</code>文档或<code>heredoc</code>，这个概念在许多其它编程语言中都可以找到。它的工作方式与前面的示例代码类似，不同之处在于**<font color="#de7802">分隔符可以是多个字符</font>**：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;END_MY_STRING_PLEASE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#66d9ef">This</span> is the string 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">And</span> a second line
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">END_MY_STRING_PLEASE</span>
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;END_TEST
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#66d9ef">This</span> is the string 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">And</span> a second line
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">END_TEST</span>
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">This</span> is the string 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">And</span> a second line
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">This</span> is the string 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">And</span> a second line
</span></span></code></pre></div><p>在上面的实例代码中，<code>&lt;&lt;</code>标记字符串字面量的开头，然后使用<code>END_MY_STRING_PLEASE</code>作为字符串常量的分隔符。字符串<font color="#de7802">真正的内容从下一个新行开始，分隔符在最后一行再次重复时表示字符串字面量结束</font>。</p>
<p>当比较字符串时，实际上比较的是字符串中每个字符对应的数字，即字符的<code>ASCII</code>码值。如前所述，字符在计算机内存中存储为数字，每个字母和符号都有一个值，称为<code>ASCII</code>码值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Success!&#34;</span> <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Test&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;String&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;TestString&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;abc&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;x&#34;</span> <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;y&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Success</span><span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>abcabcabcabcabc
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">false</span>
</span></span></code></pre></div><p>可以通过字符的<code>ord</code>方法获取<code>ASCII</code>值。相应地，也可以通过<code>chr</code>函数将<code>ASCII</code>码值转换为都应字符：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;x&#34;</span><span style="color:#f92672">.</span>ord <span style="color:#75715e">#Integer</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#ae81ff">120</span><span style="color:#f92672">.</span>chr <span style="color:#75715e">#String</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">120</span>
</span></span><span style="display:flex;"><span>x
</span></span></code></pre></div><p>插值是指将表达式的结果插入到字符串常量中的过程。在字符串中进行插值的方法是将表达式放在<code>#{}</code>内。下面是一个简单的例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>x<span style="color:#e6db74">}</span><span style="color:#e6db74"> + </span><span style="color:#e6db74">#{</span>y<span style="color:#e6db74">}</span><span style="color:#e6db74"> = </span><span style="color:#e6db74">#{</span>x <span style="color:#f92672">+</span> y<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#75715e"># 10 + 20 = 30</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;100 * 5 = </span><span style="color:#e6db74">#{</span><span style="color:#ae81ff">100</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#75715e"># 100 * 5 = 500</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cat&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;The </span><span style="color:#e6db74">#{</span>x<span style="color:#e6db74">}</span><span style="color:#e6db74"> in the hat&#34;</span> <span style="color:#75715e"># The cat in the hat</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;It&#39;s a </span><span style="color:#e6db74">#{</span><span style="color:#e6db74">&#34;bad &#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span><span style="color:#e6db74">}</span><span style="color:#e6db74">world&#34;</span> <span style="color:#75715e"># It&#39;s a bad bad bad bad bad world</span>
</span></span></code></pre></div><h3 id="regular-expressions">Regular Expressions</h3>
<p>正则表达式<font color=red>本质上是一个搜索查询</font>，不要与表达式混淆。如果想要替换字符串中的某些字符，可以使用<code>sub</code>方法。但是<code>sub</code>只替换第一次出现的字符，如果要做全局替换，则需要使用<code>gsub</code>方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;foobar&#34;</span><span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;bar&#39;</span>, <span style="color:#e6db74">&#39;foo&#39;</span>) <span style="color:#75715e"># foofoo</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;this is a test&#34;</span><span style="color:#f92672">.</span>gsub(<span style="color:#e6db74">&#39;i&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e"># ths s a test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>foofoo
</span></span><span style="display:flex;"><span>ths s a test
</span></span></code></pre></div><p>如果要替换开头的两个字符，可以使用如下方式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;This is a test&#34;</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">/^../</span>, <span style="color:#e6db74">&#39;Hello&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hellois</span> is a test
</span></span></code></pre></div><p>上面的代码中，<code>sub</code>方法的第一个参数不是字符串，而是一个正则表达式。在正则表达式中<code>^</code>是一个锚点，意味着正则表达式将从字符串中任何<font color="#de7802">行的开头开始匹配</font>。其中的<code>.</code>代表任何字符。也就是说，<code>/^../</code>意味着「紧随一行开始之后的任何两个字符」。因此，<code>This is a test</code>的<code>Th</code>被替换为<code>Hello</code>。类似地，下面的代码替换行字符串最后两个字符为<code>Hello</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;This is a test&#34;</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">/..$/</span>, <span style="color:#e6db74">&#39;Hello&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is a teHello</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;TEST
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span>this is a test 
</span></span><span style="display:flex;"><span>dddd
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">TEST</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># $表示行尾</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">/..$/</span>, <span style="color:#e6db74">&#39;Hello&#39;</span>)  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># this is a tesHello</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># dddd</span>
</span></span></code></pre></div><p>如果想锚定一个字符串的<font color=red>绝对开始或结束</font>，可以分别使用<code>\A</code>和<code>\Z</code>（字母均为大写），而<code>^</code>和<code>$</code>则只是锚定一个字符串中的<font color=red>行的开始和结束</font>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;TEST
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#66d9ef">This</span> is a test
</span></span><span style="display:flex;"><span>dd
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">TEST</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">/..\Z/</span>, <span style="color:#e6db74">&#39;Hello&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is a test</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Hello</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;TEST
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#66d9ef">This</span> is a test
</span></span><span style="display:flex;"><span>dd
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">TEST</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">/\A../</span>, <span style="color:#e6db74">&#39;NA&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NAis is a test</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># dd</span>
</span></span></code></pre></div><p>如果想遍历一个字符串访问其中的每个字符，怎么办呢？<code>scan</code>就是我们要找的迭代器方法。在下面的代码中，<code>scan</code>方法扫描字符串<font color=Blue>以查找与传递给它的正则表达式匹配的任何内容</font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">&#34;xyz&#34;</span><span style="color:#f92672">.</span>scan(<span style="color:#e6db74">/./</span>) { <span style="color:#f92672">|</span>letter<span style="color:#f92672">|</span> puts letter }
</span></span></code></pre></div><p>在上面的代码中，提供了一次查找单个字符的正则表达式。这就是在输出中分别得到<code>x、y</code>和<code>z</code>的原因。每个字母都被输入到块中，赋值给<code>letter</code>，然后打印到屏幕上。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">&#34;This is a test&#34;</span><span style="color:#f92672">.</span>scan(<span style="color:#e6db74">/../</span>) { <span style="color:#f92672">|</span>x<span style="color:#f92672">|</span> puts x }
</span></span></code></pre></div><p>在上面的代码中，一次扫描两个字符，最后的打印结果如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">Th</span>
</span></span><span style="display:flex;"><span>is
</span></span><span style="display:flex;"><span> i
</span></span><span style="display:flex;"><span>s 
</span></span><span style="display:flex;"><span>a 
</span></span><span style="display:flex;"><span>te
</span></span><span style="display:flex;"><span>st
</span></span></code></pre></div><p>实际上，上面扫描的结果中是包含空格的，如果想要只包含数字和字母，可以使用如下方式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">&#34;This is a test&#34;</span><span style="color:#f92672">.</span>scan(<span style="color:#e6db74">/\w\w/</span>) { <span style="color:#f92672">|</span>x<span style="color:#f92672">|</span> puts x }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Th</span>
</span></span><span style="display:flex;"><span>is
</span></span><span style="display:flex;"><span>is
</span></span><span style="display:flex;"><span>te
</span></span><span style="display:flex;"><span>st
</span></span></code></pre></div><p>上面的<code>\w</code>表示<font color=LightSeaGreen>任何数字和字母字符以及下划线</font>。在正则表达式中，有一些用反斜杠表示的特殊字符，它们具有特殊的含义，如下表所示：</p>
<img src="https://s2.loli.net/2022/08/21/RGeNu7VfazXjomk.png" alt="RGeNu7VfazXjomk" style="zoom:67%;" />
<p>参考上表，可以很轻松地从字符串中提取所有数字：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">&#34;The car costs $1000 and the cat costs $10&#34;</span><span style="color:#f92672">.</span>scan(<span style="color:#e6db74">/\d+/</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>x<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  puts x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 10</span>
</span></span></code></pre></div><p>在上面<code>\d</code>后面跟着的<code>+</code>被称为<font color=red>修饰器</font>，它表示尽可能多地匹配，并且至少匹配一个。如果不添加<code>+</code>，则只会匹配一个数字：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">&#34;The car costs $1000 and the cat costs $10&#34;</span><span style="color:#f92672">.</span>scan(<span style="color:#e6db74">/\d/</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>x<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  puts x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0</span>
</span></span></code></pre></div><p>还有其它类型的修饰符，如下表所示：</p>
<img src="https://s2.loli.net/2022/08/21/hv1o3iDpQXaLHYO.png" alt="hv1o3iDpQXaLHYO" style="zoom:67%;" />
<p>在正则表达式中，还有一个重要的方面是<font color=red>字符类，它允许匹配一组特定的字符</font>。例如，可以扫描字符串中的所有元音字符：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">&#34;This is a test&#34;</span><span style="color:#f92672">.</span>scan(<span style="color:#e6db74">/[aeiou]/</span>) { <span style="color:#f92672">|</span>x<span style="color:#f92672">|</span> puts x }
</span></span><span style="display:flex;"><span><span style="color:#75715e"># i</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># i</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># a</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># e</span>
</span></span></code></pre></div><p>也可以在方括号内指定字符范围：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">&#34;This is a test&#34;</span><span style="color:#f92672">.</span>scan(<span style="color:#e6db74">/[a-m]/</span>) { <span style="color:#f92672">|</span>x<span style="color:#f92672">|</span> puts x }
</span></span><span style="display:flex;"><span><span style="color:#75715e"># h</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># i</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># i</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># a</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># e</span>
</span></span></code></pre></div><p>进行替换并从字符串中提取某些文本很有用，但有时<font color=red>只想检查某个字符串是否与选择的模式匹配</font>。如果字符串包含任何元音，你可能希望快速确定：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;String has vowels&#34;</span> <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;This is a test&#34;</span> <span style="color:#f92672">=~</span> <span style="color:#e6db74">/[aeiou]/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String has vowels
</span></span></code></pre></div><p>在上面的代码中<code>=~</code>是<font color=LightSeaGreen>匹配运算符</font>，如果字符串与运算符后面的正则表达式匹配，则表达式会<font color=red>返回第一个匹配项的位置</font>（在上面这种情况下返回的是<code>2</code>——逻辑上为<code>true</code>，因此满足<code>if</code>条件）。当然，也可以做相反的事情：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;String contains no digits&#34;</span> <span style="color:#66d9ef">unless</span> <span style="color:#e6db74">&#34;This is a test&#34;</span> <span style="color:#f92672">=~</span> <span style="color:#e6db74">/[0-9]/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String contains no digits
</span></span></code></pre></div><p>上面代码的意思是除非<code>0</code>到<code>9</code>的数字范围与测试字符串匹配，否则告诉用户字符串中没有数字。也可以使用<code>String</code>类提供的<code>match</code>方法。<code>=~</code>根据正则表达式是否匹配字符串，<font color=LightSeaGreen>返回第一个匹配项的位置或<code>nil</code></font>，而<code>match</code>提供了更多的功能。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;String has vowels&#34;</span> <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;This is a test&#34;</span><span style="color:#f92672">.</span>match(<span style="color:#e6db74">/[aeiou]/</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String has vowels
</span></span></code></pre></div><p>在正则表达式中，如果用圆括号<code>（）</code>括住表达式的一部分，则与正则表达式该部分匹配的数据将与其余部分分开使用，<code>match</code>允许访问此数据：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;This is a test&#34;</span><span style="color:#f92672">.</span>match(<span style="color:#e6db74">/(\w+) (\w+)/</span>)
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">This</span> is
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">This</span>
</span></span><span style="display:flex;"><span>is
</span></span></code></pre></div><p>字符串的<code>match</code>方法返回一个<code>MatchData</code>对象，<font color=LightSeaGreen>它可以像数组一样被访问</font>。第一个元素（<code>x[0]</code>）包含由整个正则表达式匹配的数据。剩下的每个连续的元素都包含被正则表达式的每个匹配组所匹配的数据。在上面的例子中，第一个<code>（\w+）</code>匹配的是<code>This</code>，第二个<code>（\w+）</code>匹配的是<code>is</code>。</p>
<h2 id="arrays-and-lists">Arrays and Lists</h2>
<p>数组是一个对象的**<font color=red>有序集合</font>**，有序的意思是可以根据一个一致的、连续的数字索引从这个集合中选择对象。数组中的对象可以是<code>hash，file handle，classes，true</code>和<code>false</code>，以及其它任意对象。</p>
<p>在数组中，每个元素都用逗号与其相邻元素隔开，方括号用于表示数组字面量。每个元素都可以使用索引访问，<font color=red>索引也是从<code>0</code>开始，如果索引越界不会发生闪退现象，而是取到空值<code>nil</code></font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#75715e"># 3</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">[</span><span style="color:#ae81ff">4</span><span style="color:#f92672">]</span> <span style="color:#75715e"># nil</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">[</span><span style="color:#ae81ff">4</span><span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> <span style="color:#75715e">#true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> Array<span style="color:#f92672">.</span>new(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;5&#34;</span>)
</span></span><span style="display:flex;"><span>puts a
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> Array<span style="color:#f92672">.</span>new(<span style="color:#ae81ff">3</span>) { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) }
</span></span><span style="display:flex;"><span>p a
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;three&#34;</span>, <span style="color:#ae81ff">4</span>, <span style="color:#f92672">[]]</span>
</span></span><span style="display:flex;"><span>p a
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;three&#34;</span>, <span style="color:#ae81ff">4</span>, <span style="color:#f92672">[]]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;A string&#34;</span>
</span></span><span style="display:flex;"><span>p string<span style="color:#f92672">.</span>respond_to?(<span style="color:#e6db74">:to_ary</span>)
</span></span><span style="display:flex;"><span>p string<span style="color:#f92672">.</span>respond_to?(<span style="color:#e6db74">:to_a</span>)
</span></span><span style="display:flex;"><span>p Array(string)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;A string&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">string</span><span style="color:#f92672">.</span><span style="color:#a6e22e">to_a</span>
</span></span><span style="display:flex;"><span>  split(<span style="color:#e6db74">//</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p Array(string)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34; &#34;</span>, <span style="color:#e6db74">&#34;s&#34;</span>, <span style="color:#e6db74">&#34;t&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>, <span style="color:#e6db74">&#34;i&#34;</span>, <span style="color:#e6db74">&#34;n&#34;</span>, <span style="color:#e6db74">&#34;g&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#e6db74">%w{ Joe Leo III }</span>
</span></span><span style="display:flex;"><span>p <span style="color:#e6db74">%w(David\ A.\ Black is a Rubyist.)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Joe&#34;</span>, <span style="color:#e6db74">&#34;Leo&#34;</span>, <span style="color:#e6db74">&#34;III&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;David A. Black&#34;</span>, <span style="color:#e6db74">&#34;is&#34;</span>, <span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;Rubyist.&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>数组不需要设置预定义元素，可以像下面这样先创建一个空数组。然后可以使用<code>&lt;&lt;</code>操作符往数组最后添加新的元素，或者使用<code>push</code>方法添加新元素：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>push(<span style="color:#e6db74">&#34;hello&#34;</span>)
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test
</span></span><span style="display:flex;"><span>test
</span></span><span style="display:flex;"><span>hello
</span></span></code></pre></div><p>也可以从数组中一个个移除元素。<code>Ruby</code>中的<font color=red>数组可以充当栈</font>，遵循「后进先出」原则，新的元素被推送到数组的末尾并从末尾弹出（弹出是<font color=red>从数组末尾检索和删除元素的过程</font>）:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Word&#34;</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Play&#34;</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Fun&#34;</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>pop <span style="color:#75715e"># 影响原数组</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>pop
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>length
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Fun</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Play</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>如果数组中的元素都是字符串，可以使用<code>join</code>方法将所有元素连接起来：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Word&#34;</span>, <span style="color:#e6db74">&#34;Play&#34;</span>, <span style="color:#e6db74">&#34;Fun&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>join, x<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WordPlayFun</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Word</span>,<span style="color:#66d9ef">Play</span>,<span style="color:#66d9ef">Fun</span>
</span></span></code></pre></div><p>也可以使用<code>split</code>方法将字符串分隔成数组：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Short sentence. Another. No more.&#34;</span><span style="color:#f92672">.</span>split(<span style="color:#e6db74">/\./</span>)<span style="color:#f92672">.</span>inspect
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Short sentence&#34;</span>, <span style="color:#e6db74">&#34; Another&#34;</span>, <span style="color:#e6db74">&#34; No more&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>因为在正则表达式中<code>.</code>表示任意字符，所以需要使用<code>\.</code>来表示真正的点符号（加上反斜杠来对其进行转义）。而<code>inspect</code>方法对<code>Ruby</code>中几乎所有的内置类都是通用的，它提供了对象的文本表示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Words with lots of spaces&#34;</span><span style="color:#f92672">.</span>split(<span style="color:#e6db74">/\s+/</span>)<span style="color:#f92672">.</span>inspect
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Words&#34;</span>, <span style="color:#e6db74">&#34;with&#34;</span>, <span style="color:#e6db74">&#34;lots&#34;</span>, <span style="color:#e6db74">&#34;of&#34;</span>, <span style="color:#e6db74">&#34;spaces&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p><code>p</code>方法也很重要，它是<code>inspect</code>的替代方法，前面的代码也可以这样写：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>p <span style="color:#e6db74">&#34;Words with lots of spaces&#34;</span><span style="color:#f92672">.</span>split(<span style="color:#e6db74">/\s+/</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Words&#34;</span>, <span style="color:#e6db74">&#34;with&#34;</span>, <span style="color:#e6db74">&#34;lots&#34;</span>, <span style="color:#e6db74">&#34;of&#34;</span>, <span style="color:#e6db74">&#34;spaces&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p><code>p</code>是<code>puts</code>的一个非常有用的替代品，它可以自动显示后面表达式返回对象的结构。这个方法几乎不需要在生产应用中使用它，但对于调试和学习来说是非常好的。</p>
<h3 id="array-iteration">Array Iteration</h3>
<p>对于数组，可以使用<code>each</code>方法进行迭代，也可以使用<code>collect</code>方法<font color=red>即时转换数组</font>。<code>map</code>方法从功能上说是等同于<code>collect</code>方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>p <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>collect { <span style="color:#f92672">|</span>element<span style="color:#f92672">|</span> element <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> }
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>map { <span style="color:#f92672">|</span>element<span style="color:#f92672">|</span> element <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">8</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">8</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">90</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>p x
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>collect { <span style="color:#f92672">|</span>item<span style="color:#f92672">|</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> item }
</span></span><span style="display:flex;"><span>p x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">90</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">90</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">90</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>p x
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>collect! { <span style="color:#f92672">|</span>item<span style="color:#f92672">|</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> item } <span style="color:#75715e">#！表示会改变原有数组</span>
</span></span><span style="display:flex;"><span>p x
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>map! { <span style="color:#f92672">|</span>item<span style="color:#f92672">|</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>item} <span style="color:#75715e">#！表示会改变原有数组</span>
</span></span><span style="display:flex;"><span>p x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">90</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">112</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">180</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">136</span>, <span style="color:#ae81ff">224</span>, <span style="color:#ae81ff">312</span>, <span style="color:#ae81ff">360</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>数组也可以直接使用<code>+</code>和<code>-</code>操作符：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>z <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> y
</span></span><span style="display:flex;"><span>p z
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>z <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> y
</span></span><span style="display:flex;"><span>p z
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>数组的<code>empty?</code>方法可以用于检查数组中元素是否为空；而<code>include?</code>方法可以用于判断数组中是否包含某个元素：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;x is empty&#34;</span> <span style="color:#66d9ef">if</span> x<span style="color:#f92672">.</span>empty?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>p x<span style="color:#f92672">.</span>include?(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>p x<span style="color:#f92672">.</span>include?(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x is empty
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>数组的<code>first</code>方法用于获取第一个元素，<code>last</code>方法用于获取最后一个元素。如果在<code>first</code>和<code>last</code>方法中传递一个数字，那么<font color=red>将从数组的开头或结尾获取该数量的元素</font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>first
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>last
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>first(<span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#34;-&#34;</span>)
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>last(<span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>
</span></span></code></pre></div><h2 id="hashes">Hashes</h2>
<p>数组是对象的集合，<code>Hash</code>也是如此。但是，<code>Hash</code>用了不同的存储格式来定义集合中的每个对象，它更像一个字典，而不是一个列表。<code>Hash</code><font color=red>没有保证先后顺序，只是键和值之间的简单链接</font>。数组和<code>hash</code>是紧密连接的，从某种意义来说，数组也是一种<code>hash</code>，只不过其<code>key</code>是整数。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>dictionary <span style="color:#f92672">=</span> { <span style="color:#e6db74">cat</span>: <span style="color:#e6db74">&#34;feline animal&#34;</span>, <span style="color:#e6db74">dog</span>: <span style="color:#e6db74">&#34;canine animal&#34;</span> }
</span></span><span style="display:flex;"><span>p dictionary<span style="color:#f92672">.</span>size
</span></span><span style="display:flex;"><span>p dictionary<span style="color:#f92672">.</span>keys
</span></span><span style="display:flex;"><span>p dictionary<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>p dictionary<span style="color:#f92672">[</span><span style="color:#e6db74">:dog</span><span style="color:#f92672">]</span> <span style="color:#75715e">#获取value</span>
</span></span><span style="display:flex;"><span>p dictionary<span style="color:#f92672">[</span><span style="color:#e6db74">:nor</span><span style="color:#f92672">]</span> <span style="color:#75715e">#nil</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">:cat</span>, <span style="color:#e6db74">:dog</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;feline animal&#34;</span>, <span style="color:#e6db74">&#34;canine animal&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;canine animal&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hash <span style="color:#f92672">=</span> { <span style="color:#e6db74">red</span>: <span style="color:#e6db74">&#34;ruby&#34;</span>, <span style="color:#e6db74">white</span>: <span style="color:#e6db74">&#34;diamond&#34;</span>, <span style="color:#e6db74">green</span>: <span style="color:#e6db74">&#34;emerald&#34;</span> }
</span></span><span style="display:flex;"><span>hash<span style="color:#f92672">.</span>each_with_index <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>(key, value), i<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Pair </span><span style="color:#e6db74">#{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74"> is: </span><span style="color:#e6db74">#{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">#{</span>value<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Pair</span> <span style="color:#ae81ff">0</span> <span style="color:#e6db74">is</span>: red<span style="color:#f92672">/</span>ruby
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Pair</span> <span style="color:#ae81ff">1</span> <span style="color:#e6db74">is</span>: white<span style="color:#f92672">/</span>diamond
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Pair</span> <span style="color:#ae81ff">2</span> <span style="color:#e6db74">is</span>: green<span style="color:#f92672">/</span>emerald
</span></span></code></pre></div><p><code>Hash</code>中的<code>key</code>和<code>value</code>可以是<font color=red>任何类型的对象</font>，因此可以使用一个数组作为<code>Hash</code>的<code>key</code>。可以使用<code>each</code>方法遍历<code>Hash</code>中的每一个元素：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2</span> , <span style="color:#ae81ff">5</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">34</span> }
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>key, value<span style="color:#f92672">|</span> puts <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74"> equals </span><span style="color:#e6db74">#{</span>value<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;a&#34;</span>: <span style="color:#ae81ff">34</span>, <span style="color:#e6db74">&#34;5&#34;</span>: <span style="color:#ae81ff">67</span> }
</span></span><span style="display:flex;"><span>y<span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>key, value<span style="color:#f92672">|</span> puts <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74"> equals </span><span style="color:#e6db74">#{</span>value<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a equals <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>b equals <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span> equals <span style="color:#ae81ff">34</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a equals <span style="color:#ae81ff">34</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span> equals <span style="color:#ae81ff">67</span>
</span></span></code></pre></div><p>从<code>Ruby 1.9</code>开始，<font color=red>元素插入到<code>Hash</code>中的顺序将会被记住，使用<code>each</code>方法时会按这个顺序</font>进行迭代。如果想要删除<code>Hash</code>中的元素，可以使用<code>delete</code>方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> { <span style="color:#e6db74">a</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">b</span>: <span style="color:#ae81ff">2</span> }
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>delete(<span style="color:#e6db74">:a</span>)
</span></span><span style="display:flex;"><span>p x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">:b</span><span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">2</span>}
</span></span></code></pre></div><p>如果想要按条件删除<code>Hash</code>中的<code>value</code>，可以使用<code>delete_if</code>方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> { <span style="color:#e6db74">a</span>: <span style="color:#ae81ff">100</span>, <span style="color:#e6db74">b</span>: <span style="color:#ae81ff">20</span> }
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>delete_if { <span style="color:#f92672">|</span>key, value<span style="color:#f92672">|</span> value <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">25</span> }
</span></span><span style="display:flex;"><span>p x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">:a</span><span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">100</span>}
</span></span></code></pre></div><p><code>Hash</code>中也可能有<code>Hash</code>（因为<code>key</code>和<code>value</code>可以是任何类型对象），甚至数组中也包含<code>Hash</code>。因为一切都是对象，而<code>Hash</code>和数组可以包含任何其它对象，所以可以使用<code>Hash</code>和数组创建巨大的树结构：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>people <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">fred</span>: { name: <span style="color:#e6db74">&#34;Fred Elliott&#34;</span>, <span style="color:#e6db74">age</span>: <span style="color:#ae81ff">63</span>, <span style="color:#e6db74">gender</span>: <span style="color:#e6db74">&#34;male&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">favorite_painters</span>: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Monet&#34;</span>, <span style="color:#e6db74">&#34;Constable&#34;</span>, <span style="color:#e6db74">&#34;Da Vinci&#34;</span><span style="color:#f92672">]</span> },
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">janet</span>: { name: <span style="color:#e6db74">&#34;Janet S Porter&#34;</span>, <span style="color:#e6db74">age</span>: <span style="color:#ae81ff">55</span>, <span style="color:#e6db74">gender</span>: <span style="color:#e6db74">&#34;female&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts people<span style="color:#f92672">[</span><span style="color:#e6db74">:fred</span><span style="color:#f92672">][</span><span style="color:#e6db74">:age</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>puts people<span style="color:#f92672">[</span><span style="color:#e6db74">:janet</span><span style="color:#f92672">][</span><span style="color:#e6db74">:gender</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>puts people<span style="color:#f92672">[</span><span style="color:#e6db74">:janet</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">63</span>
</span></span><span style="display:flex;"><span>female
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">:name</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;Janet S Porter&#34;</span>, <span style="color:#e6db74">:age</span><span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">55</span>, <span style="color:#e6db74">:gender</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;female&#34;</span>}
</span></span></code></pre></div><h2 id="flow-control">Flow Control</h2>
<p>因为<code>unless</code>正好是<code>if</code>的反义词，所以<code>unless</code>能以完全相同的方式工作:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>age <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">unless</span> age <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;You&#39;re too young to use this system&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;So we&#39;re going to exit your program now&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">You</span><span style="color:#e6db74">&#39;re too young to use this system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">So we&#39;</span>re going to exit your program now
</span></span></code></pre></div><p>关键字<code>if</code>和<code>unless</code>均可以搭配<code>else</code>一起使用，<font color=red>但<code>unless</code>不能搭配<code>elsif</code>使用</font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> x <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Const</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;x &lt; </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">Const</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;x &gt;= </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">Const</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">unless</span> x <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Const</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;x &gt;= </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">Const</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;x &lt; </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">Const</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">13</span>
</span></span></code></pre></div><p>三元运算符是<code>if/else</code>的简单模式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>age <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>type <span style="color:#f92672">=</span> age <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">18</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;child&#34;</span> : <span style="color:#e6db74">&#34;adult&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;You are a &#34;</span> <span style="color:#f92672">+</span> type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">You</span> are a child
</span></span></code></pre></div><p>如果判断条件有多个分支，也可以使用<code>elsif</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>fruit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> fruit <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span>  color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elsif</span> fruit <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;apple&#34;</span>
</span></span><span style="display:flex;"><span>  color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elsif</span> fruit <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;banana&#34;</span>
</span></span><span style="display:flex;"><span>  color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;yellow&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;unknown&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>puts color
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>orange
</span></span></code></pre></div><p>如果有多个条件分支，也可以使用<code>case</code>，下面的代码和上面的代码是一样的效果：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>fruit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> fruit
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span>  color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;apple&#34;</span>
</span></span><span style="display:flex;"><span>  color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;banana&#34;</span>
</span></span><span style="display:flex;"><span>  color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;yellow&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;unknown&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>puts color
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>orange
</span></span></code></pre></div><p><code>case</code>还有另一个使用技巧，由于所有的<code>Ruby</code>表达式都返回一个结果，因此按照如下方式可以使前面的示例代码更短：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>fruit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span>color <span style="color:#f92672">=</span> <span style="color:#66d9ef">case</span> fruit
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;orange&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;apple&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;green&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;banana&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;yellow&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;unknown&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>puts color
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>orange
</span></span></code></pre></div><p>使用<code>case</code>语句和模式匹配提供了一种简单的方法来解构复杂对象并使用它们的数据。可以将模式匹配与<code>case</code>语句一起使用。不使用<code>case/when</code>，而是使用<code>case/in</code>以及<code>in</code>语句之后的模式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> response
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">in</span> { <span style="color:#e6db74">data</span>: data, <span style="color:#e6db74">code</span>: code }
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Success </span><span style="color:#e6db74">#{</span>data<span style="color:#e6db74">}</span><span style="color:#e6db74">, Code: </span><span style="color:#e6db74">#{</span>code<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">in</span> { <span style="color:#e6db74">error</span>: error, <span style="color:#e6db74">code</span>: code }
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Error: </span><span style="color:#e6db74">#{</span>error<span style="color:#e6db74">}</span><span style="color:#e6db74">, Code: </span><span style="color:#e6db74">#{</span>code<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p><code>until</code>也可用作循环：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">until</span> x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">99</span>
</span></span><span style="display:flex;"><span>  puts x
</span></span><span style="display:flex;"><span>  x <span style="color:#f92672">=</span> x <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span>
</span></span></code></pre></div><p>实际上，<code>until</code>也可以单独放在一行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>i = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>i = i <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> until i <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">65</span>
</span></span><span style="display:flex;"><span>puts i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">128</span>
</span></span></code></pre></div><p>在<code>{}</code>或<code>do end</code>中的代码<font color=LightSeaGreen>本质上是匿名方法或函数</font>。在代码块中可以使用<font color=red>编号参数而不使用显式变量</font>，编号参数对于提供参数名称不会为代码添加任何其他含义的情况很有用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>x = [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>]
</span></span><span style="display:flex;"><span>x.each <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  puts _1
</span></span><span style="display:flex;"><span>end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>y = { a: <span style="color:#ae81ff">1</span>, b: <span style="color:#ae81ff">21</span> }
</span></span><span style="display:flex;"><span>y.each <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  puts _1, _2
</span></span><span style="display:flex;"><span>end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span>a
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>b
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">21</span>
</span></span></code></pre></div><p>实际上，也可以编写自己的方法来处理代码块。下面定义的<code>each_vowel</code>方法，能够接受代码块做为参数，是由方法定义中变量名<code>code_block</code>之前的<code>&amp;</code>符号指定：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">each_vowel</span>(<span style="color:#f92672">&amp;</span>code_block)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">%w{a e i o u}</span><span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>vowel<span style="color:#f92672">|</span> code_block<span style="color:#f92672">.</span>call(vowel) }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>each_vowel { <span style="color:#f92672">|</span>vowel<span style="color:#f92672">|</span> puts vowel }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a
</span></span><span style="display:flex;"><span>e
</span></span><span style="display:flex;"><span>i
</span></span><span style="display:flex;"><span>o
</span></span><span style="display:flex;"><span>u
</span></span></code></pre></div><p>上面的<code>each_vowel</code>方法，还有另一种可供选择的方式来实现。即使用<code>yield</code>方法，<font color=red>它可以自动检测到任何代码块，并能获取代码块的控制权</font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">each_vowel</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">%w{a e i o u}</span><span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>vowel<span style="color:#f92672">|</span> <span style="color:#66d9ef">yield</span> vowel}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>each_vowel { <span style="color:#f92672">|</span>vowel<span style="color:#f92672">|</span> puts vowel }
</span></span></code></pre></div><p>需要特别注意的是：<font color=red>任何时候只能传递一个代码块，不可能接受两个或多个代码块</font>作为方法的参数。但是，代码块本身可能不接受、接受一个或多个参数。</p>
<p><code>Range</code>类提供了一种<code>to_a</code>方法将<code>Range</code>对象转换为数组：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#39;Z&#39;</span>)<span style="color:#f92672">.</span>to_a<span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>letter<span style="color:#f92672">|</span> print letter }
</span></span></code></pre></div><p><code>Symbols</code>是抽象的引用，通常由一个以冒号为前缀的短字符串表示。例如<code>:blue、:good</code>和<code>:name</code>都是<code>Symbols</code>，下面是一个简单</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>current_situation <span style="color:#f92672">=</span> <span style="color:#e6db74">:good</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Everything is fine&#34;</span> <span style="color:#66d9ef">if</span> current_situation <span style="color:#f92672">==</span> <span style="color:#e6db74">:good</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;PANIC!&#34;</span> <span style="color:#66d9ef">if</span> current_situation <span style="color:#f92672">==</span> <span style="color:#e6db74">:bad</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>current_situation <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;good&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Everything is fine&#34;</span> <span style="color:#66d9ef">if</span> current_situation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;good&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;PANIC!&#34;</span> <span style="color:#66d9ef">if</span> current_situation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;bad&#34;</span>
</span></span></code></pre></div><p>上面的两段代码会产生一样的结果，但不尽相同。第二段代码中，每次使用字符串<code>good</code>或<code>bad</code>时，都会独立创建一个存储在内存中的新对象。而<code>Symbols</code>只会初始化一次。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>current_situation <span style="color:#f92672">=</span> <span style="color:#e6db74">:good</span>
</span></span><span style="display:flex;"><span>other_situation <span style="color:#f92672">=</span> <span style="color:#e6db74">:good</span>
</span></span><span style="display:flex;"><span>puts current_situation<span style="color:#f92672">.</span>object_id, other_situation<span style="color:#f92672">.</span>object_id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>current_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;good&#34;</span>
</span></span><span style="display:flex;"><span>other_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bad&#34;</span>
</span></span><span style="display:flex;"><span>puts current_str<span style="color:#f92672">.</span>object_id, other_str<span style="color:#f92672">.</span>object_id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2263708</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2263708</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">940</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">960</span>
</span></span></code></pre></div><h1 id="classes-objects-and-modules">Classes, Objects, and Modules</h1>
<p>在<code>Ruby</code>中，没有必要使用<code>return</code>从方法中返回值。默认情况下，<font color=red>方法中的最后一个表达式用作返回值</font>。下面定义了一个<code>Square</code>类，其中<code>initialize</code>是一个特殊的方法，在创建基于该类的实例时调用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Square</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(side_length)
</span></span><span style="display:flex;"><span>    @side_length <span style="color:#f92672">=</span> side_length
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">area</span>
</span></span><span style="display:flex;"><span>    @side_length <span style="color:#f92672">*</span> @side_length
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>puts a<span style="color:#f92672">.</span>area
</span></span><span style="display:flex;"><span>puts b<span style="color:#f92672">.</span>area
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">25</span>
</span></span></code></pre></div><h2 id="local-variables">Local Variables</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>puts x
</span></span></code></pre></div><p>像<code>x</code>这种变量称为局部变量，它<font color=red>只能在定义它的地方使用</font>。如果在另外的方法或者对象方法中使用上面的<code>x</code>，则会出现编译错误：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">basic_method</span>
</span></span><span style="display:flex;"><span>  puts x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>basic_method
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Uncaught</span> <span style="color:#e6db74">exception</span>: undefined local variable <span style="color:#f92672">or</span> method <span style="color:#e6db74">`x&#39; for main:Object
</span></span></span></code></pre></div><p>这是因为一旦进入到<code>basic_method</code>中，就不再与创建的变量<code>x</code>在同一范围内。因为<code>x</code>是一个局部变量，它只存在它定义的地方。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">basic_method</span>
</span></span><span style="display:flex;"><span>  x <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>  puts x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>basic_method
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span>
</span></span></code></pre></div><h2 id="global-variables">Global Variables</h2>
<p><code>Ruby</code>也支持全局变量，在应用程序中的任何地方都可用，包括内部类或对象。全局变量可能很有用，但在<code>Ruby</code>中并不常用，<font color=LightSeaGreen>它们与面向对象编程的理念不太吻合</font>。如果要定义全局变量，需要在变量前加一个<code>$</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">basic_method</span>
</span></span><span style="display:flex;"><span>  puts $x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>basic_method
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span>
</span></span></code></pre></div><h2 id="instance-or-object-variables">Instance or Object Variables</h2>
<p>实例变量（也称为对象变量）之所以如此命名，是因为<font color=red>它们的作用域在当前对象内并与当前对象相关联</font>。实例变量使用前缀<code>@</code>开头，下面定义了实例变量<code>@side_length</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Square</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(side_length)
</span></span><span style="display:flex;"><span>    @side_length <span style="color:#f92672">=</span> side_length
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">area</span>
</span></span><span style="display:flex;"><span>    @side_length <span style="color:#f92672">*</span> @side_length
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">10</span>)  
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">5</span>)  
</span></span><span style="display:flex;"><span>puts a<span style="color:#f92672">.</span>area  
</span></span><span style="display:flex;"><span>puts b<span style="color:#f92672">.</span>area
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">25</span>
</span></span></code></pre></div><h2 id="class-variables">Class Variables</h2>
<p>类变量的作用范围在类本身内，而不是在该类的特定对象内。类变量定义时使用<font color=blue>两个<code>@</code>作为前缀，通常用于存储与具体对象无关的信息</font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Square</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> defined?(@@number_of_squares)
</span></span><span style="display:flex;"><span>      @@number_of_squares <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>      @@number_of_squares <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#类方法</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">count</span>
</span></span><span style="display:flex;"><span>    @@number_of_squares
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>puts <span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>count
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span></code></pre></div><h2 id="class-methods-vs-instance-methods">Class Methods vs. Instance Methods</h2>
<p>在下面<code>Square</code>类的定义中，<code>initialize</code>和<code>area</code>方法均为实例方法，它们与<code>Square</code>类的具体实例相关。因此，调用时需要先有<code>Square</code>类的实例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Square</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(side_length)
</span></span><span style="display:flex;"><span>    @side_length <span style="color:#f92672">=</span> side_length
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">area</span>
</span></span><span style="display:flex;"><span>    @side_length <span style="color:#f92672">*</span> @side_length
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>squ <span style="color:#f92672">=</span> <span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>puts squ<span style="color:#f92672">.</span>area
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">25</span>
</span></span></code></pre></div><p>如果要定义类方法，只需要在方法名前加<code>self.</code>，<code>self</code>表示当前类。下面的<code>self.test_method</code>为类方法，如果没有<code>self.</code>前缀则方法默认为实例方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Square</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">test_method</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Hello from the Square class!&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_method</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Hello from an instance of class Square!&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>test_method
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Square</span><span style="color:#f92672">.</span>new<span style="color:#f92672">.</span>test_method
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hello</span> from the <span style="color:#66d9ef">Square</span> class!
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hello</span> from an instance of <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Square</span><span style="color:#f92672">!</span>
</span></span></code></pre></div><h2 id="inheritance">Inheritance</h2>
<p>面向对象一个有趣的概念是继承，它允许<font color=red>产生一个类的分类法</font>。继承的好处是层次较低的类可以获得较高层次的特性，也可以添加它们自己的特性。<code>Ruby</code>的继承功能相当简单，任何类都可以继承另一个类的特征和功能，但一个类<font color=red>只能继承一个其它的类</font>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ParentClass</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">method1</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Hello from method1 in the parent class&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">method2</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Hello from method2 in the parent class&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChildClass</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">ParentClass</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 覆写method2方法</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">method2</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Hello from method2 in the child class&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>my_object <span style="color:#f92672">=</span> <span style="color:#66d9ef">ChildClass</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>my_object<span style="color:#f92672">.</span>method1
</span></span><span style="display:flex;"><span>my_object<span style="color:#f92672">.</span>method2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hello</span> from method1 <span style="color:#66d9ef">in</span> the parent <span style="color:#66d9ef">class</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Hello</span> from method2 <span style="color:#66d9ef">in</span> the child <span style="color:#66d9ef">class</span>
</span></span></code></pre></div><p>下面的代码中，使用<code>super</code>时它<font color=red>查找继承链并调用下一个最高层次类的同名方法</font>。在下面代码中，在 <code>Doctor</code>的<code>name</code>方法中使用<code>super</code>时，会查找<code>Person</code>中的同名<code>name</code>方法。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(name)
</span></span><span style="display:flex;"><span>    @name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>    @name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Doctor</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Dr. &#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">super</span> <span style="color:#75715e"># super表示调用父类的同名name方法</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NewDoctor</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Doctor</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;New &#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">super</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#66d9ef">Doctor</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Test&#34;</span>)<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>puts <span style="color:#66d9ef">NewDoctor</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Test&#34;</span>)<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Dr</span><span style="color:#f92672">.</span> <span style="color:#66d9ef">Test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">New</span> <span style="color:#66d9ef">Dr</span><span style="color:#f92672">.</span> <span style="color:#66d9ef">Test</span>
</span></span></code></pre></div><p>以这种方式使用继承的好处：可以<font color=LightSeaGreen>在通用类中实现通用功能，然后只需在更具体的子类中实现具体的功能</font>。这可以节省大量的重复工作，并且<font color=red>如果对父类进行了修改，子类也会继承这些修改</font>。</p>
<h2 id="overriding-existing-methods">Overriding Existing Methods</h2>
<p>因为<code>Ruby</code>是一种动态语言，所以<font color=red>可以覆盖现有的类和方法</font>。一些<code>Ruby</code>库和扩展（<code>add-ons</code>）覆盖了核心类提供的方法，以扩展<code>Ruby</code>的功能。</p>
<p>下面这个<code>demo</code>说明了为什么总是需要谨慎行事，注意应用程序中正在发生的事情。如果代码依赖于计算字符串长度的方法，而该长度方法被重写，将会出现异常的结果：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;test&#34;</span><span style="color:#f92672">.</span>length
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;N&#34;</span><span style="color:#f92672">.</span>length
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">String</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">length</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;test&#34;</span><span style="color:#f92672">.</span>length
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;N&#34;</span><span style="color:#f92672">.</span>length
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">20</span> <span style="color:#75715e"># 被覆写后调用length后返回均为20</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">20</span>
</span></span></code></pre></div><p>上面代码在<code>String</code>类的<code>length</code>方法被复写之前，输出的结果都是正常的。但当<code>length</code>方法被复写后，再调用<code>length</code>输出的结果均为<code>20</code>。</p>
<p>实际上，我们的代码也可以覆盖自定义的方法。下面代码中，首先定义了<code>Dog</code>类，然后定义了一个<code>talk</code>方法。接着又重新打开了<code>Dog</code>类，就地重定义了<code>talk</code>方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dog</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">talk</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Woof!&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>my_dog <span style="color:#f92672">=</span> <span style="color:#66d9ef">Dog</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>my_dog<span style="color:#f92672">.</span>talk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dog</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">talk</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Howl!&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>my_dog<span style="color:#f92672">.</span>talk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Woof</span><span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Howl</span><span style="color:#f92672">!</span>
</span></span></code></pre></div><p>这种<font color=red>重新打开类并添加和重新定义方法的能力在面向对象语言中是比较少见的</font>。虽然它允许执行一些有趣的技巧，但它也<font color=Blue>会导致相同的代码部分以不同的方式运行</font>，这取决于所依赖的某些类在应用程序中是否被改变，正如之前对<code>String</code>的<code>length</code>方法的重新定义所展示的那样。</p>
<h2 id="reflection-and-discovering-an-objects-methods">Reflection and Discovering an Object’s Methods</h2>
<p>反射是计算机程序在运行和使用时可以检查、分析和修改自身的过程。<code>Ruby</code>将反射发挥到了极致，<font color=red>允许在运行自己的代码的同时，改变语言本身的大量功能</font>。</p>
<p>在<code>Ruby</code>中，几乎所有对象都有可能查询到它所定义的方法，这是反射的另一部分。任何对象的<code>methods</code>方法（当然，除非<code>methods</code>方法本身被重载了），都会返回该对象可用的方法数组，这通常是一个比自定义的方法多得多的方法数组：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;This is a test&#34;</span>
</span></span><span style="display:flex;"><span>puts a<span style="color:#f92672">.</span>methods<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39; &#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>unicode_normalize unicode_normalize! ascii_only? to_r unpack encode! unpack1 <span style="color:#f92672">%</span> <span style="color:#66d9ef">include</span>? <span style="color:#f92672">*</span> <span style="color:#f92672">+</span> pretty_print count partition <span style="color:#f92672">+</span><span style="color:#960050;background-color:#1e0010">@</span> <span style="color:#f92672">-</span><span style="color:#960050;background-color:#1e0010">@</span> <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#f92672">&lt;&lt;</span> to_c <span style="color:#f92672">==</span> <span style="color:#f92672">===</span> sum <span style="color:#f92672">=~</span> <span style="color:#66d9ef">next</span> <span style="color:#f92672">[]</span> casecmp casecmp? insert <span style="color:#f92672">[]=</span> match match? bytesize empty? eql? succ! <span style="color:#66d9ef">next</span><span style="color:#f92672">!</span> upto index rindex replace clear chr getbyte setbyte scrub! scrub undump byteslice freeze inspect capitalize upcase dump downcase! swapcase downcase hex capitalize! upcase! lines length size codepoints succ split swapcase! bytes oct prepend grapheme_clusters concat start_with? reverse reverse! to_str to_sym crypt ord strip end_with? to_s to_i to_f center intern gsub ljust chars delete_suffix sub rstrip scan chomp rjust lstrip chop! delete_prefix chop sub! gsub! delete_prefix! chomp! strip! lstrip! rstrip! squeeze delete_suffix! tr tr_s delete each_line tr! tr_s! delete! squeeze! slice each_byte each_char each_codepoint each_grapheme_cluster b slice! rpartition encoding force_encoding valid_encoding? hash unicode_normalized? encode clamp between? <span style="color:#f92672">&lt;=</span> <span style="color:#f92672">&gt;=</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span> pretty_print_inspect pretty_print_instance_variables pretty_print_cycle dup itself yield_self <span style="color:#66d9ef">then</span> taint tainted? untaint untrust untrusted? trust frozen? methods singleton_methods protected_methods private_methods public_methods instance_variables instance_variable_get instance_variable_set instance_variable_defined? remove_instance_variable instance_of? kind_of? is_a? tap display <span style="color:#66d9ef">class</span> singleton_class clone public_send method public_method singleton_method define_singleton_method pretty_inspect <span style="color:#66d9ef">extend</span> to_enum enum_for <span style="color:#f92672">!~</span> <span style="color:#66d9ef">nil</span>? respond_to? object_id send __send__ <span style="color:#f92672">!</span> <span style="color:#f92672">!=</span> __id__ equal? instance_eval instance_exec
</span></span></code></pre></div><p>上面打印的结果，取决于当前机器环境和<code>Ruby</code>版本。打印的结果也显示了一些其它的反射性方法，例如：<code>protected_ methods</code>、<code>private_methods</code>和<code>public_methods</code>都揭示了以不同方式封装的方法。</p>
<p>另一个有趣的方法是<code>instance_variables</code>，它返回与一个实例相关的所有实例变量的名称（相对于类变量而言）。下面的代码中，打印了实例变量<code>@name</code>和<code>@age</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 两个实例属性</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:name</span>, <span style="color:#e6db74">:age</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fred&#34;</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>age <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>puts p<span style="color:#f92672">.</span>instance_variables
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@name
</span></span><span style="display:flex;"><span>@age
</span></span></code></pre></div><h2 id="encapsulation">Encapsulation</h2>
<p>封装描述了数据和方法捆绑在一起成为一个单元一起运行的方式。封装可以使功能隐藏在类中，并控制外部世界能够如何操作对象中的数据，下面是一个<code>Person</code>类的例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(name)
</span></span><span style="display:flex;"><span>    set_name(name)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>    @first_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">+</span> @last_name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_name</span>(name)
</span></span><span style="display:flex;"><span>    first_name, last_name <span style="color:#f92672">=</span> name<span style="color:#f92672">.</span>split(<span style="color:#e6db74">/\s+/</span>)
</span></span><span style="display:flex;"><span>    set_first_name(first_name)
</span></span><span style="display:flex;"><span>    set_last_name(last_name)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_first_name</span>(name)
</span></span><span style="display:flex;"><span>    @first_name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_last_name</span>(name)
</span></span><span style="display:flex;"><span>    @last_name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>在之前的示例代码中，使用<code>attr_accessor :name</code>来声明属性，并且能够十分简单地使用<code>name</code>。上面的示例代码是为了说明封装的概念。</p>
<p>在上面的代码中，<code>first_name</code>和<code>last_name</code>存储在<code>Person</code>类中，当<code>Person</code>实例生成时，<code>name</code>被分割为两部分，并分别赋值给<code>first_name</code>和<code>last_name</code>。</p>
<p>一种可能的原因是想在应用程序中使用完整的<code>name</code>，但数据库设计可能要求把<code>first_name</code>和<code>last_name</code>放在不同列中。因此，需要在类的代码中处理这个差异。</p>
<p>上面这种方法的另一个好处是，可以在把数据赋值给对象变量之前对其进行检查。例如，在<code>set_first_name</code>和<code>set_last_name</code>方法中，可以检查<code>name</code>是否包含足够的字符以被认为是有效的<code>name</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Fred Bloggs&#34;</span>)
</span></span><span style="display:flex;"><span>puts p<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Fred</span> <span style="color:#66d9ef">Bloggs</span>
</span></span></code></pre></div><p>仍然可以发现一些问题：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Fred Bloggs&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>set_last_name(<span style="color:#e6db74">&#34;Smith&#34;</span>)
</span></span><span style="display:flex;"><span>puts p<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Fred</span> <span style="color:#66d9ef">Smith</span>
</span></span></code></pre></div><p>实际上我们只想通过设置<code>name</code>来修改<code>first_name</code>和<code>last_name</code>，然而<code>set_first_name</code>和<code>set_last_name</code>这两个方法依然是公开的，可以通过<code>Person</code>的实例直接调用。幸运的是<font color=LightSeaGreen>可以使用封装来解决这个问题</font>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(name)
</span></span><span style="display:flex;"><span>    set_name(name)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>    @first_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">+</span> @last_name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_name</span>(name)
</span></span><span style="display:flex;"><span>    first_name, last_name <span style="color:#f92672">=</span> name<span style="color:#f92672">.</span>split(<span style="color:#e6db74">/\s+/</span>)
</span></span><span style="display:flex;"><span>    set_first_name(first_name)
</span></span><span style="display:flex;"><span>    set_last_name(last_name)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_first_name</span>(name)
</span></span><span style="display:flex;"><span>    @first_name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_last_name</span>(name)
</span></span><span style="display:flex;"><span>    @last_name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Fred Bloggs&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>set_last_name(<span style="color:#e6db74">&#34;Smith&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Uncaught</span> <span style="color:#e6db74">exception</span>: <span style="color:#66d9ef">private</span> method set_last_name called <span style="color:#66d9ef">for</span> <span style="color:#e6db74">Person</span>:<span style="color:#ae81ff">0x00007fa79e101a60</span>
</span></span></code></pre></div><p>上面添加了<code>private</code>关键字，它告诉<code>Ruby</code>从这个关键字出现的地方开始在这个类中声明的任何方法都应该保持私有。因此，上面的代码运行后会出现编译错误：<code>Uncaught exception: private method set_last_name called for Person:0x00007fa79e101a60</code>。</p>
<p>而<code>private</code>关键字的反面是<code>public</code>，可以在一个方法之前放上<code>private</code>关键字，那么其后定义的方法都是私有方法。之后再使用<code>public</code>关键字时，其后的方法都是公开的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">anyone_can_access_this</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">this_is_private</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">another_public_method</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>也可以使用<code>private</code>作为一个命令，<font color=LightSeaGreen>其后紧跟代表方法的符号</font>。下面的示例代码是告诉<code>Ruby</code>，方法<code>this_is_private</code>和<code>this_is_also_private</code>都是私有的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">anyone_can_access_this</span>; <span style="color:#f92672">...</span>; <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">this_is_private</span>; <span style="color:#f92672">...</span>; <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">this_is_also_private</span>; <span style="color:#f92672">...</span>; <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">another_public_method</span>; <span style="color:#f92672">...</span>; <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#e6db74">:this_is_private</span>, <span style="color:#e6db74">:this_is_also_private</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>不管选择将<code>private</code>作为方法前的指令，还是直接将其放在方法名前，都是可以的。<font color=red>但需要注意的是<code>private</code>命令声明必须在方法定义之后</font>。</p>
<p><code>Ruby</code>支持第三种形式的封装（除了<code>public</code>和<code>private</code>），叫做<code>protected</code>。它能让一个方法在类的范围内成为私有的，而不是在一个单独的对象内。</p>
<p>无法在对象及其方法的范围之外直接调用一个<code>private</code>方法。但可以从任何对象方法的范围内调用一个受保护的方法，该对象是同一个类的成员：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(age)
</span></span><span style="display:flex;"><span>    @age <span style="color:#f92672">=</span> age
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">age</span>
</span></span><span style="display:flex;"><span>    @age
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">age_difference_with</span>(other_person)
</span></span><span style="display:flex;"><span>    (self<span style="color:#f92672">.</span>age <span style="color:#f92672">-</span> other_person<span style="color:#f92672">.</span>age)<span style="color:#f92672">.</span>abs
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">protected</span> <span style="color:#e6db74">:age</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fred <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">34</span>)
</span></span><span style="display:flex;"><span>chris <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">25</span>)
</span></span><span style="display:flex;"><span>puts chris<span style="color:#f92672">.</span>age_difference_with(fred)
</span></span><span style="display:flex;"><span>puts chris<span style="color:#f92672">.</span>age
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Uncaught</span> <span style="color:#e6db74">exception</span>: <span style="color:#66d9ef">protected</span> method <span style="color:#e6db74">`age&#39; called for #&lt;Person:0x00007fdb990660b8 @age=25&gt;
</span></span></span></code></pre></div><p>在上面的例子中，使用<code>protected</code>指令设置的保护方法<code>age</code>不能直接使用，除非是在属于<code>Person</code>类的方法中使用。但是，如果把<code>age</code>变成私有的，前面的例子就会失败，因为<code>other_ person.age</code>将无法通过编译。这是因为<code>private</code>使得方法<font color=red>只能被特定对象的方法所访问</font>。</p>
<h2 id="polymorphism">Polymorphism</h2>
<p>多态是指编写可以同时处理多种类型的代码。例如，<code>+</code>方法适用于数字相加、字符串连接和数组相加，<code>+</code>的作用完全取决于你想要把什么类型的东西加在一起。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Animal</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:name</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(name)
</span></span><span style="display:flex;"><span>    @name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Cat</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Animal</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">talk</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Meaow!&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dog</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Animal</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">talk</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Woof!&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>animals <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">Cat</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Flossie&#34;</span>), <span style="color:#66d9ef">Dog</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Clive&#34;</span>), <span style="color:#66d9ef">Cat</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Max&#34;</span>)<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>animals<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>animal<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  puts animal<span style="color:#f92672">.</span>talk
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Meaow</span><span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Woof</span><span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Meaow</span><span style="color:#f92672">!</span>
</span></span></code></pre></div><p>上面定义了<code>3</code>个类，<code>Animal,Cat</code>和<code>Dog</code>。数组<code>animals</code>中包含了两个<code>Cat</code>对象实例和一个<code>Dog</code>对象实例，在循环迭代时会调用<code>talk</code>方法，打印的结果是<code>Meaow!，Woof!，Meaow!</code>。</p>
<p>一些内置的类，例如<code>Array, Hash, String</code>已经实现一些多态方法。例如，可以在许多内置类上调用<code>to_s</code>方法，将对象的内容作为一个字符串返回：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#ae81ff">1000</span><span style="color:#f92672">.</span>to_s
</span></span><span style="display:flex;"><span>puts <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">].</span>to_s
</span></span><span style="display:flex;"><span>puts ({ name: <span style="color:#e6db74">&#39;Fred&#39;</span>, <span style="color:#e6db74">age</span>: <span style="color:#ae81ff">10</span> })<span style="color:#f92672">.</span>to_s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">:name</span><span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#34;Fred&#34;</span>, <span style="color:#e6db74">:age</span><span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">10</span>}
</span></span></code></pre></div><h2 id="nested-classes">Nested Classes</h2>
<p>可以在类中再定义类，这种类被称为内嵌类。当想把类分成几组，而不是把它们都分开时，内嵌类会很有用。下面在<code>Drawing</code>中定义了两个内嵌类：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Drawing</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Line</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Circle</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>内嵌类的定义和普通类的定义一样，但是使用方式上有差异。如果要从<code>Drawing</code>之外访问<code>Line</code>和<code>Circle</code>，必须使用<code>Drawing::Line</code>和<code>Drawing::Circle</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Drawing</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">give_me_a_circle</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Circle</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Line</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Circle</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">what_am_i</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;This is a circle&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#66d9ef">Drawing</span><span style="color:#f92672">.</span>give_me_a_circle
</span></span><span style="display:flex;"><span>puts a<span style="color:#f92672">.</span>what_am_i
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#66d9ef">Drawing</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Circle</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>puts b<span style="color:#f92672">.</span>what_am_i
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#66d9ef">Drawing</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Circle</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>puts c<span style="color:#f92672">.</span>what_am_i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">This</span> is a circle
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">This</span> is a circle
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">This</span> is a circle
</span></span></code></pre></div><h2 id="the-scope-of-constants">The Scope of Constants</h2>
<p>常量是在当前类范围内定义的，并且对所有子类都是可用的，除非它们被重写。下面代码中，如果不重定义<code>Pi</code>，那么<code>OtherPlanet</code>就能够使用原定义的<code>Pi</code>，因为<code>OtherPlanet</code>类是定义在全局范围内：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">circumference_of_circle</span>(radius)
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">Pi</span> <span style="color:#f92672">*</span> radius
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Pi</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">.</span><span style="color:#ae81ff">141592</span>
</span></span><span style="display:flex;"><span>puts circumference_of_circle(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OtherPlanet</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Pi虽然是常量，但可以被重置</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">Pi</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">circumference_of_circle</span>(radius)
</span></span><span style="display:flex;"><span>    radius <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">Pi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#66d9ef">OtherPlanet</span><span style="color:#f92672">.</span>circumference_of_circle(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>puts <span style="color:#66d9ef">OtherPlanet</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Pi</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#66d9ef">OtherPlanet</span><span style="color:#f92672">.</span>circumference_of_circle(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">62</span><span style="color:#f92672">.</span><span style="color:#ae81ff">83184</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Pi被重新赋值后</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">90</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">90</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h2 id="modules-namespaces-and-mix-ins">Modules, Namespaces, and Mix-Ins</h2>
<p>模块提供了一种结构，将<code>Ruby</code>的类、方法和常量收集到一个单独命名的单元中。这样就可以避免与现有的类、方法和常量发生冲突，也可以把模块的功能加入到你的类中。首先，来看看如何使用模块来创建命名空间，以避免同名冲突。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># number_stuff文件</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">random</span>
</span></span><span style="display:flex;"><span>  rand(<span style="color:#ae81ff">1000000</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>puts random
</span></span></code></pre></div><p>上面定义的<code>random</code>方法返回<code>0</code>到<code>999,999</code>之间的随机数。这个方法可能在一个远程文件中，它很容易被遗忘，如果有另一个文件也实现了同样的方法，就会造成问题：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># letter_stuff文件</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">random</span>
</span></span><span style="display:flex;"><span>  (rand(<span style="color:#ae81ff">26</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">65</span>)<span style="color:#f92672">.</span>chr
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>上面方法产生<code>A</code>到<code>Z</code>的随机字母。现在有两个名为<code>random</code>的方法了，如果第一个<code>random</code>方法所在文件为<code>number_stuff.rb</code>，第二个<code>random</code>方法所在文件为<code>letter_stuff.rb</code>。<code>require</code>是一个<code>Ruby</code>语句，用于加载另一个文件中的代码，下面的代码就会出现问题：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;./number_stuff&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;./letter_stuff&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts random
</span></span></code></pre></div><p>可以看到，当代码运行后，使用的是字母版的<code>random</code>方法，这是因为上面出现了名字冲突，数字版的<code>random</code>被数字版的<code>random</code>覆盖。模块有助于解决这些冲突，它提供了可以包含任何数量的类、方法和常量的命名空间，并允许直接处理它们。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> NumberStuff
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">random</span>
</span></span><span style="display:flex;"><span>    rand (<span style="color:#ae81ff">1000000</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> LetterStuff
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">random</span>
</span></span><span style="display:flex;"><span>    (rand(<span style="color:#ae81ff">26</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">65</span>)<span style="color:#f92672">.</span>chr
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#66d9ef">NumberStuff</span><span style="color:#f92672">.</span>random
</span></span><span style="display:flex;"><span>puts <span style="color:#66d9ef">LetterStuff</span><span style="color:#f92672">.</span>random
</span></span></code></pre></div><p>下面的代码中有两个模块，第一个中定义了一个<code>Ruler</code>类，它有<code>length</code>属性。第二个模块也定义了一个<code>Ruler</code>类，它包含了<code>name</code>属性：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ToolBox
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Ruler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:length</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> Country
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Ruler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:name</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#66d9ef">ToolBox</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Ruler</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>a<span style="color:#f92672">.</span>length <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#66d9ef">Country</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Ruler</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>b<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Genghis Khan from Moskau&#34;</span>
</span></span></code></pre></div><p>因为<code>Ruby</code><font color=red>不支持多重继承</font>，所以不具备同时从多个类中继承的能力。<code>Ruby</code>的继承功能只允许创建简单的类树，避免了多重继承系统所带来的混乱。</p>
<p>但是，在某些情况下，在<font color=Blue>不同类之间共享功能是很有用的</font>。在这个意义上，模块就像一种方法、类和常量的捆绑，可以被包含在其它类中。例如，用模块提供的方法来扩展该类:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> UsefulFeatures
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">class_name</span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>class<span style="color:#f92672">.</span>to_s
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">UsefulFeatures</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>puts x<span style="color:#f92672">.</span>class_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Person</span>
</span></span></code></pre></div><p>在上面的代码中，<code>UsefulFeatures</code>看起来像是一个类。但是，模块是组织工具，而不是类本身。<code>class_ name</code>方法存在于模块中，然后被包含在<code>Person</code>类中，下面是另一个例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> AnotherModule
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_stuff</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;This is a test&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">include</span> <span style="color:#66d9ef">AnotherModule</span>
</span></span><span style="display:flex;"><span>do_stuff
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行后的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">This</span> is a test
</span></span></code></pre></div><p>从上面的代码中可以看出，即使没有直接在一个类中，也可以在当前作用域里<code>include</code>一个模块，然后直接使用里面的方法。也可以直接使用模块中的方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># 需要先include该模块</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">include</span> <span style="color:#66d9ef">AnotherModule</span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">AnotherModule</span><span style="color:#f92672">.</span>do_stuff
</span></span></code></pre></div><p>也就是说，<code>include</code>接收一个模块并将其内容包含在当前范围内。<code>Kernel</code>模块包含了所有「标准」命令（如<code>load、require、exit、puts</code>和<code>eval</code>）。这些方法不是直接在对象的范围内定义的，而是通过默认包含<code>Kernel</code>模块实现。</p>
<p>然而，我们更感兴趣的是<code>Ruby</code>提供的模块，可以在自己的类中包含这些模块来立即获得更多的功能。</p>
<h2 id="enumerable">Enumerable</h2>
<p>数组类已经预先包含了<code>Enumerable</code>模块提供的方法，这个模块提供了大约<code>20</code>个相关的方法，包括<code>collect, detect, find, find_all, include?, max, min, select, sort, and to_a</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>p <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>collect { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> i<span style="color:#f92672">.</span>to_s <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;x&#34;</span> }
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 检测到就返回一个，detect是find的别名</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>detect { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> i<span style="color:#f92672">.</span>between?(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>) }
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>select { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> i<span style="color:#f92672">.</span>between?(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>) }
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">[</span><span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">].</span>sort
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>max
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>min
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;1x&#34;</span>, <span style="color:#e6db74">&#34;2x&#34;</span>, <span style="color:#e6db74">&#34;3x&#34;</span>, <span style="color:#e6db74">&#34;4x&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>上面这些方法都使用<code>Array</code>的<code>each</code>方法来完成它们的工作，如果自定义类可以实现<code>each</code>方法，就可以使用<code>include</code>包含<code>Enumerable</code>，并在自己的类中获得所有方法:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AllVowels</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">VOWELS</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">%w{a e i o u}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">each</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">VOWELS</span><span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> <span style="color:#66d9ef">yield</span> v }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#66d9ef">AllVowels</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> puts v }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span>a
</span></span><span style="display:flex;"><span>e
</span></span><span style="display:flex;"><span>i
</span></span><span style="display:flex;"><span>o
</span></span><span style="display:flex;"><span>u
</span></span></code></pre></div><p>因为在<code>AllVowels</code>类中定义了<code>each</code>方法，又包含了<code>Enumerable</code>模块，所以能使用相应的迭代方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AllVowels</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Enumerable</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">VOWELS</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">%w{a e i o u}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">each</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">VOWELS</span><span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> <span style="color:#66d9ef">yield</span> v }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#66d9ef">AllVowels</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>p x<span style="color:#f92672">.</span>collect { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;x&#34;</span> }
</span></span><span style="display:flex;"><span>p x<span style="color:#f92672">.</span>detect { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> i <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;j&#34;</span> }
</span></span><span style="display:flex;"><span>p x<span style="color:#f92672">.</span>select { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> i <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;j&#34;</span> }
</span></span><span style="display:flex;"><span>p x<span style="color:#f92672">.</span>sort
</span></span><span style="display:flex;"><span>p x<span style="color:#f92672">.</span>max
</span></span><span style="display:flex;"><span>p x<span style="color:#f92672">.</span>min
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;ax&#34;</span>, <span style="color:#e6db74">&#34;ex&#34;</span>, <span style="color:#e6db74">&#34;ix&#34;</span>, <span style="color:#e6db74">&#34;ox&#34;</span>, <span style="color:#e6db74">&#34;ux&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;o&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;o&#34;</span>, <span style="color:#e6db74">&#34;u&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;e&#34;</span>, <span style="color:#e6db74">&#34;i&#34;</span>, <span style="color:#e6db74">&#34;o&#34;</span>, <span style="color:#e6db74">&#34;u&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;u&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;a&#34;</span>
</span></span></code></pre></div><h2 id="comparable">Comparable</h2>
<p>模块<code>Comparable</code>提供了比较操作符，例如<code>&lt;,&lt;=,==,&gt;=,&gt;</code>以及<code>between?</code>方法。为了提供这些方法，<code>Comparable</code>模块在包含它的类上使用<code>&lt;=&gt;</code>比较操作符。如果提供的参数高于该对象的值，则<code>&lt;=&gt;</code>操作符返回<code>-1</code>，如果相等则返回0，如果对象的值大于提供的参数则返回<code>1</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>p <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>p <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>p <span style="color:#ae81ff">2</span> <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>有了这个简单的方法，<code>Comparable</code>模块可以提供其它基本的比较运算符和<code>between?</code>方法，下面是自定义类：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Song</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Comparable</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:length</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">&lt;=&gt;</span>(other)
</span></span><span style="display:flex;"><span>    @length <span style="color:#f92672">&lt;=&gt;</span> other<span style="color:#f92672">.</span>length
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(song_name, length)
</span></span><span style="display:flex;"><span>    @song_name <span style="color:#f92672">=</span> song_name
</span></span><span style="display:flex;"><span>    @length <span style="color:#f92672">=</span> length
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#66d9ef">Song</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;Rock around the clock&#39;</span>, <span style="color:#ae81ff">143</span>)
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#66d9ef">Song</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;Bohemian Rhapsody&#39;</span>, <span style="color:#ae81ff">544</span>)
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#66d9ef">Song</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;Minute Waltz&#39;</span>, <span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p a <span style="color:#f92672">&lt;</span> b
</span></span><span style="display:flex;"><span>p b <span style="color:#f92672">&gt;=</span> c
</span></span><span style="display:flex;"><span>p c <span style="color:#f92672">&gt;</span> a
</span></span><span style="display:flex;"><span>p a<span style="color:#f92672">.</span>between?(c,b)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行后打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">true</span>
</span></span></code></pre></div><h2 id="using-mix-ins-with-namespaces-and-classes">Using Mix-Ins with Namespaces and Classes</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ToolBox
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Ruler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:length</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> Country
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Ruler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:name</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#66d9ef">ToolBox</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Ruler</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>a<span style="color:#f92672">.</span>length <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#66d9ef">Country</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Ruler</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>b<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Genghis Khan of Moskau&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 包含Country模块后可以直接使用name</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Country</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#66d9ef">Ruler</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>c<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;King Henry VIII&#34;</span>
</span></span></code></pre></div><h1 id="advanced-ruby-features">Advanced Ruby Features</h1>
<h2 id="dynamic-code-execution">Dynamic Code Execution</h2>
<p>作为一种动态解释型语言，<code>Ruby</code>能够执行动态创建的代码。这样做的方法是使用<code>eval</code>方法，例如下面的代码执行后打印结果为<code>4</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>eval <span style="color:#e6db74">&#34;puts 2 + 2&#34;</span>
</span></span></code></pre></div><p>上面<code>eval</code>表达式的返回值并非<code>4</code>，而是<code>nil</code>，因为<code>puts</code>作为表达式的放回值为<code>nil</code>。如果要返回4，必须这样写：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts eval(<span style="color:#e6db74">&#34;2 + 2&#34;</span>)
</span></span></code></pre></div><p>下面是一个使用字符串和插值的更复杂的示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>my_number <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>my_code <span style="color:#f92672">=</span> <span style="color:#e6db74">%{</span><span style="color:#e6db74">#{</span>my_number<span style="color:#e6db74">}</span><span style="color:#e6db74"> * 2}</span>
</span></span><span style="display:flex;"><span>puts my_code
</span></span><span style="display:flex;"><span>puts eval(my_code)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">15</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">30</span>
</span></span></code></pre></div><p>实际上<code>eval</code>方法只是执行（或求值）<font color=red>传递给它的代码并返回结果</font>。最上面的例子是让<code>eval</code>执行<code>puts 2 + 2</code>，上面的例子是执行<code>15 * 2</code>。</p>
<h2 id="bindings">Bindings</h2>
<p>在<code>Ruby</code>中，<font color=Blue>绑定是对上下文、作用域或执行状态的引用</font>。绑定包括变量的当前值和执行环境的其它细节。可以将绑定传递给<code>eval</code>并让<code>eval</code>在这个传递绑定执行代码，而不是当前绑定。通过这种方式，可以将<code>eval</code>要执行的代码与当前代码的执行上下文分开：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">binding_elsewhere</span>
</span></span><span style="display:flex;"><span>  x <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> binding
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>remote_binding <span style="color:#f92672">=</span> binding_elsewhere
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>eval(<span style="color:#e6db74">&#34;puts x&#34;</span>)
</span></span><span style="display:flex;"><span>eval(<span style="color:#e6db74">&#34;puts x&#34;</span>, remote_binding)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">20</span>
</span></span></code></pre></div><p>上面的代码表明<code>eval</code>接受一个可选的<code>bindling</code>参数，这个参数是方法<code>binding_elsewhere</code>返回的，它包含了<code>binding_elsewhere</code>的上下文。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>eval(<span style="color:#e6db74">&#34;x = 10&#34;</span>)
</span></span><span style="display:flex;"><span>eval(<span style="color:#e6db74">&#34;x = 50&#34;</span>, remote_binding)
</span></span><span style="display:flex;"><span>eval(<span style="color:#e6db74">&#34;puts x&#34;</span>)
</span></span><span style="display:flex;"><span>eval(<span style="color:#e6db74">&#34;puts x&#34;</span>, remote_binding)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">50</span>
</span></span></code></pre></div><p>在上面的代码中有两个<code>bindling</code>在起作用：默认<code>bindling</code>和<code>remote_ binding</code>（来自<code>binding_elsewhere</code>方法）。第一个<code>x</code>的值是在默认<code>bindling</code>中设置，另一个是在<code>remote_ binding</code>中设置的。</p>
<h2 id="other-forms-of-eval">Other Forms of eval</h2>
<p>尽管<code>eval</code>在当前上下文（或<code>bindling</code>提供的上下文）中执行代码，但<code>class_eval、module_eval</code>和<code>instance_eval</code>可以分别在类、模块和对象实例上下文中执行代码。<code>class_eval</code>非常适合动态向类添加方法:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_accessor_to_person</span>(accessor_name)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>class_eval <span style="color:#e6db74">%{attr_accessor :</span><span style="color:#e6db74">#{</span>accessor_name<span style="color:#e6db74">}</span><span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>person <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>add_accessor_to_person <span style="color:#e6db74">:name</span>
</span></span><span style="display:flex;"><span>add_accessor_to_person <span style="color:#e6db74">:gender</span>
</span></span><span style="display:flex;"><span>person<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Carleton DiLeo&#34;</span>
</span></span><span style="display:flex;"><span>person<span style="color:#f92672">.</span>gender <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;male&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>person<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74"> is </span><span style="color:#e6db74">#{</span>person<span style="color:#f92672">.</span>gender<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Carleton</span> <span style="color:#66d9ef">DiLeo</span> is male
</span></span></code></pre></div><p>在上面的示例中，使用<code>add_accessor_to_person</code>方法将访问器动态添加到<code>Person</code>类。在使用 <code>add_accessor_to_person</code>方法之前，名称和性别访问器都不存在于<code>Person</code>中。代码的关键部分<code>class_eval</code>方法通过使用字符串插值来为<code>Person</code>创建所需的属性。</p>
<p>字符串插值使<code>eval</code>方法成为动态生成不同特征的强大工具。这种能力是大多数编程语言中看不到的一种能力，并且在诸如<code>Ruby on Rails</code>之类的系统中发挥了巨大的作用。</p>
<p>可以在前面的例子中更进一步，通过<code>class_eval</code>强大功能放在一个新的方法中，定义在<code>Class</code>类中（<font color=red>所有其它的类都来自于此</font>），为每个类添加一个<code>add_accessor</code>方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Class</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_accessor</span>(accessor_name)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>class_eval <span style="color:#e6db74">%{ attr_accessor :</span><span style="color:#e6db74">#{</span>accessor_name<span style="color:#e6db74">}</span><span style="color:#e6db74"> }</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>person <span style="color:#f92672">=</span> <span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>add_accessor <span style="color:#e6db74">:name</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Person</span><span style="color:#f92672">.</span>add_accessor <span style="color:#e6db74">:gender</span>
</span></span><span style="display:flex;"><span>person<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Carleton DiLeo&#34;</span>
</span></span><span style="display:flex;"><span>person<span style="color:#f92672">.</span>gender <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;male&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>person<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74"> is </span><span style="color:#e6db74">#{</span>person<span style="color:#f92672">.</span>gender<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Carleton</span> <span style="color:#66d9ef">DiLeo</span> is male
</span></span></code></pre></div><p>因为<code>add_accessor</code>是在一个类中使用的，这个方法调用将一直进行到<code>Class</code>类中定义的<code>add_accessor</code>方法。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomethingElse</span>  
</span></span><span style="display:flex;"><span>  add_accessor <span style="color:#e6db74">:whatever</span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>  
</span></span><span style="display:flex;"><span>ever <span style="color:#f92672">=</span> <span style="color:#66d9ef">SomethingElse</span><span style="color:#f92672">.</span>new  
</span></span><span style="display:flex;"><span>ever<span style="color:#f92672">.</span>whatever <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;test&#34;</span>  
</span></span><span style="display:flex;"><span>puts ever<span style="color:#f92672">.</span>whatever
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span>test
</span></span></code></pre></div><p>回到更简单的技术，使用<code>instance_eval</code>有点像使用常规<code>eval</code>，但作用在对象（而不是方法）的上下文中。在下面示例中，使用<code>instance_eval</code>在对象范围内执行代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>
</span></span><span style="display:flex;"><span>    @my_variable <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Hello, world!&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">MyClass</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>obj<span style="color:#f92672">.</span>instance_eval { puts @my_variable }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Hello</span>, world!
</span></span></code></pre></div><h2 id="creating-your-own-version-of-attr_accessor">Creating Your Own Version of attr_accessor</h2>
<p>到目前为止，已经在自定义的类中使用<code>attr_accessor</code>方法来快速生成实例变量的访问函数。例如，在可能手写下面这样的代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>    @name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span>(name)
</span></span><span style="display:flex;"><span>    @name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>上面的代码允许使用<code>puts person.name</code>和<code>person.name = 'Fred'</code>。同样地，也可以使用<code>attr_accessor</code>添加属性：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:name</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>这样定义的类更加简洁，并且与普通版本具有完全相同的功能。现在是时候问这个问题了，<code>attr_accessor</code>是如何工作的？</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Class</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_accessor</span>(accessor_name)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>class_eval <span style="color:#e6db74">%{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      def </span><span style="color:#e6db74">#{</span>accessor_name<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        @</span><span style="color:#e6db74">#{</span>accessor_name<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      def </span><span style="color:#e6db74">#{</span>accessor_name<span style="color:#e6db74">}</span><span style="color:#e6db74">=(value)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          @</span><span style="color:#e6db74">#{</span>accessor_name<span style="color:#e6db74">}</span><span style="color:#e6db74"> = value
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><h2 id="running-other-programs-from-ruby">Running Other Programs from Ruby</h2>
<p>有三种简单的方法运行另一个程序:</p>
<ul>
<li><code>system</code>方法（定义在<code>Kernel</code>模块中）</li>
<li><code>backtick syntax</code></li>
<li>限定的输入字元（<code>%x{}</code>）</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> system(<span style="color:#e6db74">&#34;ls&#34;</span>)
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#e6db74">`ls`</span> <span style="color:#75715e">#backtick syntax</span>
</span></span><span style="display:flex;"><span>puts x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行结果</span>
</span></span><span style="display:flex;"><span>letter_stuff<span style="color:#f92672">.</span>rb	number_stuff<span style="color:#f92672">.</span>rb	test<span style="color:#f92672">.</span>rb
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>letter_stuff<span style="color:#f92672">.</span>rb
</span></span><span style="display:flex;"><span>number_stuff<span style="color:#f92672">.</span>rb
</span></span><span style="display:flex;"><span>test<span style="color:#f92672">.</span>rb
</span></span></code></pre></div><p>上面的第一行代码中，<code>ls</code>的输出会打印在控制台，并且<code>x</code>的值等于<code>true</code>。而在第<code>3</code>行中，<code>x</code>的值包含<code>list</code>命令的输出。也就是说，想运行另一个程序而不关心它的输出时，使用<code>system</code>是理想的，而当你想返回程序的输出时，应该使用<code>backticks</code>方式。</p>
<p><code>%x{}</code>的功能等同于使用<code>backticks</code>，例如<code>%x{ls}</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#e6db74">%x{ls}</span>
</span></span><span style="display:flex;"><span>puts y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行结果</span>
</span></span><span style="display:flex;"><span>letter_stuff<span style="color:#f92672">.</span>rb
</span></span><span style="display:flex;"><span>number_stuff<span style="color:#f92672">.</span>rb
</span></span><span style="display:flex;"><span>test<span style="color:#f92672">.</span>rb
</span></span></code></pre></div><h2 id="transferring-execution-to-another-program">Transferring Execution to Another Program</h2>
<p>有时想要停止当前程序的执行并立即跳到另一个程序。要结束当前程序并调用另一个程序，只需使用<code>exec</code>方法来代替<code>system</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>exec <span style="color:#e6db74">&#34;ruby letter_stuff.rb&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下面代码不会执行，因为exec会结束当前程序</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;This will never be displayed&#34;</span>
</span></span></code></pre></div><h2 id="running-two-programs-at-the-same-time">Running Two Programs at the Same Time</h2>
<p><code>Forking</code>是指一个程序的实例（一个进程）复制自己，导致该程序的两个进程同时运行。<code>fork</code>是<code>Kernel</code>模块提供的方法，用于创建当前进程的分叉。它在父进程中返回子进程的进程<code>ID</code>，但在子进程中返回<code>nil</code>&ndash;可以用它来确定一个脚本在哪个进程中。</p>
<p>下面的例子将当前进程分叉为两个进程，并且只在子进程（由分叉产生的进程）中执行<code>exec</code>命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> fork<span style="color:#f92672">.</span>nil?
</span></span><span style="display:flex;"><span>  exec <span style="color:#e6db74">&#34;ruby letter_stuff.rb&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;This Ruby script now runs alongside letter_stuff.rb&#34;</span>
</span></span></code></pre></div><p>如果另一个程序（被<code>exec</code>执行后）预计在某个时间点完成，想在父程序中做某些事情之前等待它完成执行，可以使用<code>Process.wait</code>来等待所有子进程完成后再继续：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>child <span style="color:#f92672">=</span> fork <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  sleep <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Child says &#39;hi&#39;!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Waiting for the child process...&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Process</span><span style="color:#f92672">.</span>wait child
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;All done!&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Waiting</span> <span style="color:#66d9ef">for</span> the child process<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Child</span> says <span style="color:#e6db74">&#39;hi&#39;</span><span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">All</span> done!
</span></span></code></pre></div><p>在<code>Windows</code>版本的<code>Ruby</code>中，分叉是不可能的，因为该平台上不支持<code>POSIX-style</code>分叉，应当使用对应的<code>spawn()</code>方法。</p>
<h2 id="threads">Threads</h2>
<p>线程是执行线程的简称。用线程把一个程序的执行分成多个部分，可以同时运行。例如，一个被设计为同时给数千人发送电子邮件的程序可能会将任务分成<code>20</code>个不同的线程，这些线程都会同时发送电子邮件。</p>
<p>这种并行性比一个接一个地处理要快，特别是在有多<code>CPU</code>的系统上，因为不同的执行线程可以在不同的处理器上运行。即使在单<code>CPU</code>上它也可以更快，因为与其浪费时间等待远程机器的响应，不如继续进行其它操作。</p>
<p><code>Ruby 1.8</code>并不支持传统意义上的线程。通常，<font color=red>线程能力是由操作系统提供的，并且在不同的系统中有所不同</font>。然而，<code>Ruby 1.8</code>提供了<code>Ruby</code>的线程能力，这意味着它们缺乏传统系统级线程的一些能力。在<code>Ruby 1.9</code>中，<code>Ruby</code>开始使用基于系统的线程，这也是是<code>Rubyists</code>中所期望的结果。</p>
<p>虽然<code>Ruby 1.9</code>和<code>2.x</code>的线程是系统（原生）线程，<font color=Blue>但为了与<code>1.8</code>代码保持兼容，全局解释器锁（<code>GIL</code>）被保留下来，所以线程不会真正同时运行</font>。这意味着本节所涉及的所有内容都与<code>1.8、1.9、2.0</code>及以后的所有版本有关。本章的下一个主要部分将介绍<code>Ruby 1.9</code>及更高版本的替代品&ndash;<code>fibers</code>，它现在支持非阻塞并发。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>threads <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span><span style="color:#f92672">.</span>times <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  thread <span style="color:#f92672">=</span> <span style="color:#66d9ef">Thread</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">10</span><span style="color:#f92672">.</span>times { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> print i; $stdout<span style="color:#f92672">.</span>flush; sleep rand(<span style="color:#ae81ff">2</span>) }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  threads <span style="color:#f92672">&lt;&lt;</span> thread
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>threads<span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>thread<span style="color:#f92672">|</span> thread<span style="color:#f92672">.</span>join }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">000000012301200114561111231234567</span><span style="color:#ae81ff">8234512323454279234233346648445756757567958586867689967987878989999</span>
</span></span></code></pre></div><p>一旦创建了线程，就要等待所有的线程在程序结束前完成。可以通过循环浏览线程中的所有线程对象并调用每个线程的<code>join</code>方法来等待。<code>join</code>方法使主进程等待，直到一个线程的执行完成后再继续。通过这种方式，可以确保在退出之前所有的线程都完成了。</p>
<h2 id="fibers">Fibers</h2>
<p>在<code>Ruby 1.9</code>及以后的版本中提供了线程的替代品<code>Fibers</code>。在<code>Ruby 3</code>中<code>Fiber</code>被重写了，<font color=red>它不再对<code>IO</code>操作进行阻塞，并支持非阻塞的<code>fibers</code></font>。</p>
<p><code>fibers</code>是轻量级的执行单元，它可以控制自己的调度（通常被称为合作调度）。线程通常会持续运行，而<code>fibers</code>一旦执行完某些任务就会移交控制权。</p>
<p>与常规方法不同，一旦<code>fibers</code>交出控制权，<font color=Blue>它就会继续存在，并可以随意恢复</font>。简而言之，<code>fibers</code>在实用上类似于线程，但<code>fibers</code>并不被安排在一起运行，我们必须手动控制<code>fibers</code>的调度。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>sg <span style="color:#f92672">=</span> <span style="color:#66d9ef">Fiber</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  s <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">loop</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    square <span style="color:#f92672">=</span> s <span style="color:#f92672">*</span> s
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Fiber</span><span style="color:#f92672">.</span>yield square
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span><span style="color:#f92672">.</span>times { puts sg<span style="color:#f92672">.</span>resume }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">25</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">36</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">49</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">81</span>
</span></span></code></pre></div><p>上面的代码中，使用<code>block</code>创建了一个<code>fiber</code>。创建的<code>fiber</code>将会完全独立运行，直到<code>Fiber.yield</code>方法将控制权交还给告诉<code>fiber</code>运行的东西（上面的代码是<code>sg.resume</code>方法的调用）。另外，若<code>fiber</code>运行结束，在<code>fiber</code>中最后执行表达式的值将被返回。</p>
<p>当恢复<code>fiber</code>执行时，可以将数据传回<code>fiber</code>，也可以从<code>fiber</code>中接收数据。例如，调整一下平方数发生器的<code>fiber</code>以支持接收一个可选的新基数来提供平方数：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>sg <span style="color:#f92672">=</span> <span style="color:#66d9ef">Fiber</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  s <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">loop</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    square <span style="color:#f92672">=</span> s <span style="color:#f92672">*</span> s
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">=</span> <span style="color:#66d9ef">Fiber</span><span style="color:#f92672">.</span>yield(square) <span style="color:#f92672">||</span> s
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume
</span></span><span style="display:flex;"><span>puts sg<span style="color:#f92672">.</span>resume
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行后的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1600</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1681</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1764</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>
</span></span></code></pre></div><p><code>Ruby 3</code>引入了创建非阻塞<code>fiber</code>的能力。创建一个非阻塞<code>fiber</code>很简单：在构造函数中指定参数<code>blocking </code>为<code>false</code>。这个选项可以防止阻塞操作，如<code>I/O、sleep</code>等的阻塞。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>non_blocking <span style="color:#f92672">=</span> <span style="color:#66d9ef">Fiber</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">blocking</span>: <span style="color:#66d9ef">false</span>) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;Blocking Fiber? </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">Fiber</span><span style="color:#f92672">.</span>current<span style="color:#f92672">.</span>blocking?<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Will not block</span>
</span></span><span style="display:flex;"><span>  sleep <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>times { puts non_blocking<span style="color:#f92672">.</span>resume }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Blocking</span> <span style="color:#66d9ef">Fiber</span>? <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>当正确使用时，非阻塞<code>fiber</code>将提高性能，因为多个操作是一次性执行的。由于非阻塞<code>fiber</code>是选择加入的，<code>Ruby 3</code>不会破坏现有的代码。默认情况下，在<code>Ruby 3</code>中，<code>fiber</code>中的所有I/O操作都是无阻塞的。</p>
<p>在某些情况下，使用<code>fiber</code>而不是线程的动机是效率。创建数百个<code>fiber</code>比创建同等的线程要快得多，因为线程是在操作系统层面创建的。此外，<code>fiber</code>还有显著的内存效率优势。</p>
<p><code>Fiber</code>最大的好处之一是在其他库中实现轻量级的<code>I/O</code>管理例程，所以即使你不直接使用<code>fiber</code>，你最终也可能从其他地方的使用中获益。</p>
<h1 id="organizing-objects-with-classes-1">Organizing objects with classes</h1>
<p><code>Object</code>是一个内置类，当在一个类上使用点符号时，就是向这个类发送了一个信息。如同对象一样，类也可以接受消息。事实上，<font color=red>类就是对象</font>。</p>
<p>在类定义时，用<code>class</code>关键字。类名是用常量名的规则来命名的，这是一种特殊的标识符。而常量用于存储信息和在程序运行过程中不会改变的值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">m</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;First definition of method m&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">m</span>
</span></span><span style="display:flex;"><span>    puts <span style="color:#e6db74">&#34;Second definition of method m&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>C<span style="color:#f92672">.</span>new<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Second</span> definition of method m
</span></span></code></pre></div><p>上面代码运行后，将会看到打印的是<code>Second definition of method m</code>。即当我们<code>override</code>一个方法时，<font color=Blue>最新定义的版本才具有高优先级</font>。</p>
<h2 id="reopening-classes">Reopening classes</h2>
<p>在大多数情况下，定义一个类时会创建一个类的定义块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># class code here </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>但是，也可以重新打开一个类以增加一些或改变某些东西。在下面的代码中，首先打开了类的定义，增加了方法<code>x</code>，然后关闭。接着又打开，增加了方法<code>y</code>，然后又关闭：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">y</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>分解类定义的一个原因是将它们分散在多个文件中。如果需要一个包含类定义的文件（也许在运行时从另一个文件中加载它），而在需要第二个文件的文件中也有同一个类的部分定义，这两个定义就会被合并。这不是你随意做的事情：<font color=Blue>这一定是程序的设计要求一个类部分地在一个地方定义，部分地在另一个地方定义的情况</font>。</p>
<p><code>Ruby</code>有一个<code>Time</code>类，它可以操作时间，使他们格式化为时间戳。可以使用<code>UNIX</code>样式的日期格式字符串来获得所需的格式:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>puts <span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>new<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#34;%m-%d-%y&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">09</span><span style="color:#f92672">-</span><span style="color:#ae81ff">18</span><span style="color:#f92672">-</span><span style="color:#ae81ff">22</span>
</span></span></code></pre></div><p>除了内置的<code>Time</code>类，<code>Ruby</code>还有一个名为<code>time.rb</code>的程序文件，它包含了对<code>Time</code>类的各种增强和补充。<code>time.rb</code>通过重新打开<code>Time</code>类来实现增强<code>Time</code>类目的。如果在<code>Ruby</code>源代码树的<code>lib</code>子目录或<code>Ruby</code>安装中查找文件<code>time.rb</code>，将会看到：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">class</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#66d9ef">Time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># A hash of timezones mapped to hour differences from UTC. The</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># set of time zones corresponds to the ones specified by RFC 2822</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># and ISO 8601.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ZoneOffset</span> <span style="color:#f92672">=</span> { <span style="color:#75715e"># :nodoc:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;UTC&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>      
</span></span></code></pre></div><p>方法<code>xmlschema</code>是在<code>time.rb</code>中定义的，内置的<code>Time</code>类并没有该方法。下面代码在使用<code>require 'time'</code>前会出现编译错误，一旦导入<code>time.rb</code>，则不会出现编译错误：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>t <span style="color:#f92672">=</span> <span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>t<span style="color:#f92672">.</span>xmlschema
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 编译出现错误</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Uncaught</span> <span style="color:#e6db74">exception</span>: undefined method <span style="color:#e6db74">`xmlschema&#39; for xxx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 需要先require &#39;time&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">require &#39;time&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">t.xmlschema
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">09-25-22
</span></span></span></code></pre></div><p>虽然可以将单个类代码分布在多个文件或同一文件中的多个位置，但最好不要这样做。对于<code>Time</code>扩展，大家建议了一种统一可能性：首先给<code>Time</code>对象所有扩展方法，而不是将这些方法分离到单独的库中。这种统一可能会在<code>Ruby</code>的后续版本中实现。</p>
<p>Ruby 1.9及以上版本允许在实际源代码文件中使用任何支持的字符集。所需要做的就是在第一行或第二行（如果使用的是<code>shebang</code>行）加入一个注释，其中包含编码:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># coding:utf-8</span>
</span></span></code></pre></div><h1 id="debug">debug</h1>
<p>在<code>Gemfile</code>中添加如下内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>  gem <span style="color:#e6db74">&#39;debase&#39;</span>
</span></span><span style="display:flex;"><span>  gem <span style="color:#e6db74">&#39;ruby-debug-ide&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>IPC<span style="color:#f92672">]</span> Connection::waitForSyncReply: Timed-out <span style="color:#66d9ef">while</span> waiting <span style="color:#66d9ef">for</span> reply <span style="color:#66d9ef">for</span> WebPage_TouchEventSync from process 584, id<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// 网络异常导致的同步问题
</span></span></code></pre></div><h2 id="no-sdk-specified">No SDK specified</h2>
<p>使用<code>Intellij Idea</code>调试<code>Ruby</code>代码时，如果出现如下提示，根本原因是未识别到当前工程为<code>Ruby</code>工程，只需按照<a href="https://www.jetbrains.com/help/idea/configuring-language-interpreter.html#select_ruby_interpreter">参考资料</a>操作即可：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">No</span> <span style="color:#66d9ef">Ruby</span> interpreter configured <span style="color:#66d9ef">for</span> the project
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Error</span> running <span style="color:#e6db74">&#39;study&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">No</span> <span style="color:#66d9ef">SDK</span> specified
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">extension</span> <span style="color:#a6e22e">UIView</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">makeSecure</span>() {
</span></span><span style="display:flex;"><span>        DispatchQueue.main.async {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> field = UITextField()
</span></span><span style="display:flex;"><span>            field.isSecureTextEntry = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            field.backgroundColor = .clear
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.addSubview(field)
</span></span><span style="display:flex;"><span>            field.centerYAnchor.constraint(equalTo: <span style="color:#66d9ef">self</span>.centerYAnchor).isActive = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            field.centerXAnchor.constraint(equalTo: <span style="color:#66d9ef">self</span>.centerXAnchor).isActive = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.layer.superlayer?.addSublayer(field.layer)
</span></span><span style="display:flex;"><span>            field.layer.sublayers?.first?.addSublayer(<span style="color:#66d9ef">self</span>.layer)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><a href="https://stackoverflow.com/questions/13484516/ios-detection-of-screenshot">参考资料</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">extension</span> <span style="color:#a6e22e">UIView</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">setScreenCaptureProtection</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">guard</span> superview <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> subview <span style="color:#66d9ef">in</span> subviews { <span style="color:#75715e">// to avoid layer cyclic crash, when it is a topmost view, adding all its subviews in textfield&#39;s layer, </span><span style="color:#75715e">TODO:</span><span style="color:#75715e"> Find a better logic.</span>
</span></span><span style="display:flex;"><span>                subview.setScreenCaptureProtection()
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> guardTextField = UITextField()
</span></span><span style="display:flex;"><span>        guardTextField.backgroundColor = .clear
</span></span><span style="display:flex;"><span>        guardTextField.translatesAutoresizingMaskIntoConstraints = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        guardTextField.isSecureTextEntry = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        addSubview(guardTextField)
</span></span><span style="display:flex;"><span>        guardTextField.isUserInteractionEnabled = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        sendSubviewToBack(guardTextField)
</span></span><span style="display:flex;"><span>        layer.superlayer?.addSublayer(guardTextField.layer)
</span></span><span style="display:flex;"><span>        guardTextField.layer.sublayers?.first?.addSublayer(layer)
</span></span><span style="display:flex;"><span>        guardTextField.topAnchor.constraint(equalTo: <span style="color:#66d9ef">self</span>.topAnchor, constant: <span style="color:#ae81ff">0</span>).isActive = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        guardTextField.bottomAnchor.constraint(equalTo: <span style="color:#66d9ef">self</span>.bottomAnchor, constant: <span style="color:#ae81ff">0</span>).isActive = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        guardTextField.leadingAnchor.constraint(equalTo: <span style="color:#66d9ef">self</span>.leadingAnchor, constant: <span style="color:#ae81ff">0</span>).isActive = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        guardTextField.trailingAnchor.constraint(equalTo: <span style="color:#66d9ef">self</span>.trailingAnchor, constant: <span style="color:#ae81ff">0</span>).isActive = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ShyView</span>: UIView {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">lazy</span> <span style="color:#66d9ef">var</span> hiddenView: UIView? = {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> hiddenView: UIView
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> textField = UITextField()
</span></span><span style="display:flex;"><span>        textField.isSecureTextEntry = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        hiddenView = textField.layer.sublayers?.first?.delegate <span style="color:#66d9ef">as</span>! UIView
</span></span><span style="display:flex;"><span>        hiddenView.subviews.forEach { $0.removeFromSuperview() }
</span></span><span style="display:flex;"><span>        hiddenView.isUserInteractionEnabled = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> hiddenView
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">required</span> <span style="color:#66d9ef">init</span>?(coder: NSCoder) {
</span></span><span style="display:flex;"><span>        fatalError(<span style="color:#e6db74">&#34;init(coder:) has not been implemented&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">init</span>?(<span style="color:#66d9ef">_</span> subview: UIView) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span>.<span style="color:#66d9ef">init</span>(frame: .zero)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> textField = UITextField()
</span></span><span style="display:flex;"><span>        textField.isSecureTextEntry = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">guard</span> <span style="color:#66d9ef">let</span> hiddenView = textField.layer.sublayers?.first?.delegate <span style="color:#66d9ef">as</span>? UIView
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Something doesn&#39;t work, please fill an issue with your OS and device version.&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        hiddenView.subviews.forEach { $0.removeFromSuperview() }
</span></span><span style="display:flex;"><span>        hiddenView.isUserInteractionEnabled = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        backgroundColor = .clear
</span></span><span style="display:flex;"><span>        hiddenView.translatesAutoresizingMaskIntoConstraints = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        addSubview(hiddenView)
</span></span><span style="display:flex;"><span>        NSLayoutConstraint.activate([
</span></span><span style="display:flex;"><span>            hiddenView.leadingAnchor.constraint(equalTo: leadingAnchor),
</span></span><span style="display:flex;"><span>            hiddenView.trailingAnchor.constraint(equalTo: trailingAnchor),
</span></span><span style="display:flex;"><span>            hiddenView.bottomAnchor.constraint(equalTo: bottomAnchor),
</span></span><span style="display:flex;"><span>            hiddenView.topAnchor.constraint(equalTo: topAnchor)
</span></span><span style="display:flex;"><span>        ])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        subview.translatesAutoresizingMaskIntoConstraints = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        hiddenView.addSubview(subview)
</span></span><span style="display:flex;"><span>        NSLayoutConstraint.activate([
</span></span><span style="display:flex;"><span>            hiddenView.leadingAnchor.constraint(equalTo: subview.leadingAnchor),
</span></span><span style="display:flex;"><span>            hiddenView.trailingAnchor.constraint(equalTo: subview.trailingAnchor),
</span></span><span style="display:flex;"><span>            hiddenView.bottomAnchor.constraint(equalTo: subview.bottomAnchor),
</span></span><span style="display:flex;"><span>            hiddenView.topAnchor.constraint(equalTo: subview.topAnchor)
</span></span><span style="display:flex;"><span>        ])
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>sh: pod: command not found
</span></span></code></pre></div><img src="https://s2.loli.net/2022/08/18/hgHszfndWUDXxFC.png" alt="hgHszfndWUDXxFC" style="zoom:80%;" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">getRectInfo</span>() -&gt; (CGRect, CGRect, UIInterfaceOrientation)? {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> semaphore = DispatchSemaphore(value: <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> info: (scanFrame: CGRect, viewFrame: CGRect, orientation: UIInterfaceOrientation)? = <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    DispatchQueue.main.safeAsync { [<span style="color:#66d9ef">weak</span> <span style="color:#66d9ef">self</span>] <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">guard</span> <span style="color:#66d9ef">let</span> strongSelf = <span style="color:#66d9ef">self</span> <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            semaphore.signal()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        info?.scanFrame = strongSelf.scanView.frame
</span></span><span style="display:flex;"><span>        info?.viewFrame = strongSelf.view.frame
</span></span><span style="display:flex;"><span>        info?.orientation = strongSelf.interfaceOrientation
</span></span><span style="display:flex;"><span>        semaphore.signal()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    semaphore.wait()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> info
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">dyld</span>: <span style="color:#e6db74">unloaded</span>: <span style="color:#e6db74">/Developer/us</span>r<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libBacktraceRecording<span style="color:#f92672">.</span>dylib
</span></span><span style="display:flex;"><span><span style="color:#e6db74">dyld</span>: <span style="color:#e6db74">unloaded</span>: <span style="color:#e6db74">/Developer/us</span>r<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libMainThreadChecker<span style="color:#f92672">.</span>dylib
</span></span><span style="display:flex;"><span><span style="color:#e6db74">dyld</span>: <span style="color:#e6db74">unloaded</span>: <span style="color:#e6db74">/Developer/</span><span style="color:#66d9ef">Library</span><span style="color:#f92672">/</span><span style="color:#66d9ef">PrivateFrameworks</span><span style="color:#f92672">/</span><span style="color:#66d9ef">MTLToolsDeviceSupport</span><span style="color:#f92672">.</span>framework<span style="color:#f92672">/</span>libMTLInterpose<span style="color:#f92672">.</span>dylib
</span></span><span style="display:flex;"><span><span style="color:#e6db74">dyld</span>: <span style="color:#e6db74">unloaded</span>: <span style="color:#e6db74">/Developer/</span><span style="color:#66d9ef">Library</span><span style="color:#f92672">/</span><span style="color:#66d9ef">PrivateFrameworks</span><span style="color:#f92672">/</span><span style="color:#66d9ef">DTDDISupport</span><span style="color:#f92672">.</span>framework<span style="color:#f92672">/</span>libViewDebuggerSupport<span style="color:#f92672">.</span>dylib
</span></span><span style="display:flex;"><span><span style="color:#e6db74">dyld</span>: <span style="color:#66d9ef">Library</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">loaded</span>: <span style="color:#e6db74">/System/</span><span style="color:#66d9ef">Library</span><span style="color:#f92672">/</span><span style="color:#66d9ef">Frameworks</span><span style="color:#f92672">/</span><span style="color:#66d9ef">Network</span><span style="color:#f92672">.</span>framework<span style="color:#f92672">/</span><span style="color:#66d9ef">Network</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">Referenced</span> <span style="color:#e6db74">from</span>: <span style="color:#e6db74">/var/</span>containers<span style="color:#f92672">/</span><span style="color:#66d9ef">Bundle</span><span style="color:#f92672">/</span><span style="color:#66d9ef">Application</span><span style="color:#f92672">/</span>xxx<span style="color:#f92672">/</span>xxx<span style="color:#f92672">.</span>app<span style="color:#f92672">/</span>xxx
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">Reason</span>: image <span style="color:#f92672">not</span> found
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> fileAttributes = <span style="color:#66d9ef">try</span>? FileManager.<span style="color:#66d9ef">default</span>.attributesOfItem(atPath: fileUrl.path), <span style="color:#66d9ef">let</span> bytes = fileAttributes[.size] <span style="color:#66d9ef">as</span>? UInt64 {
</span></span><span style="display:flex;"><span>  sizes = bytes
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </div>
    <footer class="post-footer">
        
 
<div class="post-tags">     
     
    <a href="https://iihui.github.io/tags/ruby" rel="tag" title="ruby">#ruby#</a>
    
</div>



        <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="https://iihui.github.io/post/ios-solutions-2022/" rel="next" title="一些问题的解决方案2022">
        <i class="fa fa-chevron-left"></i> 一些问题的解决方案2022
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="https://iihui.github.io/post/tool-parallel/" rel="prev" title="Parallels Desktop 使用">
        Parallels Desktop 使用 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
        <div class="post-nav">
    <div style="border: 1px dashed #e0e0e0; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
        <div style="float:left;margin-top:0px;">
            <img src="https://i.loli.net/2020/02/09/SvhUdz4XJsOr9Vk.jpg" width="128px" height="128px"/>
            <div style="text-align:center;">谢谢支持!</div>
        </div>
        <div>
            <p style="margin-top:10px;">
                标题：Ruby基础
                <br />作者：阿呆<a target="_blank" href="https://iihui.github.io/"></a>
                
                <br />地址：https://iihui.github.io/post/ruby/
                <br />声明：自由转载-非商用-保持署名（创作共享4.0许可证）
            </p>
        </div>
    </div>
    <div class="clear"></div>
</div>
        
        
        




    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

  <ul class="sidebar-nav motion-element">
    <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
      文章目录
    </li>
    <li class="sidebar-nav-overview" data-target="site-overview">
      站点概览
    </li>
  </ul>

    <section class="site-overview sidebar-panel ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="https://i.loli.net/2020/02/07/dVFzrvZkHRNq2lL.jpg"
        alt="" />
    <p class="site-author-name" itemprop="name"></p>
    <p class="site-description motion-element" itemprop="description"> 
        coder &amp; cook</p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="https://iihui.github.io/post/">
        <span class="site-state-item-count">140</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="https://iihui.github.io/categories/">      
         
        <span class="site-state-item-count">18</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="https://iihui.github.io/tags/">
         
        <span class="site-state-item-count">29</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://coolshell.cn" target="_blank" title="皓 大">
            <i class="fa fa-fw fa-globe"></i>
            皓 大
        </a>
        </span>
    
        <span class="links-of-author-item">
        <a href="http://www.ruanyifeng.com" target="_blank" title="阮 大">
            <i class="fa fa-fw fa-globe"></i>
            阮 大
        </a>
        </span>
    
        <span class="links-of-author-item">
        <a href="https://juejin.im/" target="_blank" title="掘 金">
            <i class="fa fa-fw fa-globe"></i>
            掘 金
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
<section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
    <div class="post-toc">
        <div class="post-toc-content"><nav id="TableOfContents">
  <ul>
    <li><a href="#the-variety-of-ruby-identifiers">The variety of Ruby identifiers</a>
      <ul>
        <li><a href="#variables">Variables</a></li>
        <li><a href="#object">Object</a></li>
        <li><a href="#local-variables-and-variable-assignment">Local variables and variable assignment</a></li>
        <li><a href="#references-and-method-arguments">References and method arguments</a></li>
        <li><a href="#local-variables-and-the-things-that-look-like-them">Local variables and the things that look like them</a></li>
      </ul>
    </li>
    <li><a href="#organizing-objects-with-classes">Organizing objects with classes</a></li>
    <li><a href="#data-expressions-and-flow-control">Data, Expressions, and Flow Control</a>
      <ul>
        <li><a href="#numbers-and-expressions">Numbers and Expressions</a></li>
        <li><a href="#puts和print的区别">puts和print的区别</a></li>
        <li><a href="#looping-through-numbers-with-blocks-and-iterators">Looping Through Numbers with Blocks and Iterators</a></li>
        <li><a href="#floating-point-numbers">Floating Point Numbers</a></li>
        <li><a href="#constants">Constants</a></li>
        <li><a href="#text-and-strings">Text and Strings</a>
          <ul>
            <li><a href="#regular-expressions">Regular Expressions</a></li>
          </ul>
        </li>
        <li><a href="#arrays-and-lists">Arrays and Lists</a>
          <ul>
            <li><a href="#array-iteration">Array Iteration</a></li>
          </ul>
        </li>
        <li><a href="#hashes">Hashes</a></li>
        <li><a href="#flow-control">Flow Control</a></li>
      </ul>
    </li>
    <li><a href="#classes-objects-and-modules">Classes, Objects, and Modules</a>
      <ul>
        <li><a href="#local-variables">Local Variables</a></li>
        <li><a href="#global-variables">Global Variables</a></li>
        <li><a href="#instance-or-object-variables">Instance or Object Variables</a></li>
        <li><a href="#class-variables">Class Variables</a></li>
        <li><a href="#class-methods-vs-instance-methods">Class Methods vs. Instance Methods</a></li>
        <li><a href="#inheritance">Inheritance</a></li>
        <li><a href="#overriding-existing-methods">Overriding Existing Methods</a></li>
        <li><a href="#reflection-and-discovering-an-objects-methods">Reflection and Discovering an Object’s Methods</a></li>
        <li><a href="#encapsulation">Encapsulation</a></li>
        <li><a href="#polymorphism">Polymorphism</a></li>
        <li><a href="#nested-classes">Nested Classes</a></li>
        <li><a href="#the-scope-of-constants">The Scope of Constants</a></li>
        <li><a href="#modules-namespaces-and-mix-ins">Modules, Namespaces, and Mix-Ins</a></li>
        <li><a href="#enumerable">Enumerable</a></li>
        <li><a href="#comparable">Comparable</a></li>
        <li><a href="#using-mix-ins-with-namespaces-and-classes">Using Mix-Ins with Namespaces and Classes</a></li>
      </ul>
    </li>
    <li><a href="#advanced-ruby-features">Advanced Ruby Features</a>
      <ul>
        <li><a href="#dynamic-code-execution">Dynamic Code Execution</a></li>
        <li><a href="#bindings">Bindings</a></li>
        <li><a href="#other-forms-of-eval">Other Forms of eval</a></li>
        <li><a href="#creating-your-own-version-of-attr_accessor">Creating Your Own Version of attr_accessor</a></li>
        <li><a href="#running-other-programs-from-ruby">Running Other Programs from Ruby</a></li>
        <li><a href="#transferring-execution-to-another-program">Transferring Execution to Another Program</a></li>
        <li><a href="#running-two-programs-at-the-same-time">Running Two Programs at the Same Time</a></li>
        <li><a href="#threads">Threads</a></li>
        <li><a href="#fibers">Fibers</a></li>
      </ul>
    </li>
    <li><a href="#organizing-objects-with-classes-1">Organizing objects with classes</a>
      <ul>
        <li><a href="#reopening-classes">Reopening classes</a></li>
      </ul>
    </li>
    <li><a href="#debug">debug</a>
      <ul>
        <li><a href="#no-sdk-specified">No SDK specified</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div>
</section>

  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2017 - 2024</span>
  <span class="with-love"><i class="fa fa-heart"></i></span>
  <span class="author" itemprop="copyrightHolder">Keep It Simple</span>
</div>




      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="https://iihui.github.io/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="https://iihui.github.io/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="https://iihui.github.io/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="https://iihui.github.io/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="https://iihui.github.io/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="https://iihui.github.io/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="https://iihui.github.io/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="https://iihui.github.io/js/utils.js"></script>
<script type="text/javascript" src="https://iihui.github.io/js/motion.js"></script>
<script type="text/javascript" src="https://iihui.github.io/js/affix.js"></script>
<script type="text/javascript" src="https://iihui.github.io/js/schemes/pisces.js"></script>

<script type="text/javascript" src="https://iihui.github.io/js/scrollspy.js"></script>
<script type="text/javascript" src="https://iihui.github.io/js/post-details.js"></script>
<script type="text/javascript" src="https://iihui.github.io/js/toc.js"></script>

<script type="text/javascript" src="https://iihui.github.io/js/bootstrap.js"></script>

<script type="text/javascript" src="https://iihui.github.io/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>